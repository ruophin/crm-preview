(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1c104b9c"],{"634a":function(t,e,a){},b10d:function(t,e,a){"use strict";var i=a("634a"),n=a.n(i);n.a},db5c:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"medicaldetails"},[a("div",{staticClass:"list-top"},[a("div",{staticClass:"list-top-left"},[t._v("渠道基础信息")]),a("el-form",{ref:"form",staticClass:"w670 mt15",attrs:{model:t.form,rules:t.rules,"label-width":"auto"}},[a("el-form-item",{attrs:{label:"渠道名称：",prop:"name"}},[a("el-input",{attrs:{placeholder:"请输入"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),a("div",{staticClass:"flex j-sb"},[a("el-form-item",{attrs:{label:"所属一级渠道：",prop:"level1_contact_way_id"}},[a("el-select",{attrs:{placeholder:"请选择一级渠道"},on:{change:t.changeDitch},model:{value:t.form.level1_contact_way_id,callback:function(e){t.$set(t.form,"level1_contact_way_id",e)},expression:"form.level1_contact_way_id"}},t._l(t.ditchList,(function(t){return a("el-option",{key:t.contact_way_id,attrs:{label:t.name,value:t.contact_way_id}})})),1)],1),a("el-form-item",{attrs:{label:"所属二级渠道：",prop:"level2_contact_way_id"}},[a("el-select",{attrs:{placeholder:"请选择二级渠道"},on:{change:t.changeDitch2},model:{value:t.form.level2_contact_way_id,callback:function(e){t.$set(t.form,"level2_contact_way_id",e)},expression:"form.level2_contact_way_id"}},t._l(t.ditchList2,(function(t){return a("el-option",{key:t.contact_way_id,attrs:{label:t.name,value:t.contact_way_id}})})),1)],1)],1),a("el-form-item",{attrs:{label:"渠道标签："}},[t._l(t.form.tag_id_list,(function(e){return a("el-tag",{key:e,staticClass:"mr10",attrs:{closable:"","disable-transitions":!1},on:{close:function(a){return t.handleCloseTag(e)}}},[t._v(" "+t._s(t.tagList.filter((function(t){return t.tag_id==e}))[0].name||"--")+" ")])})),a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.tagDialog=!0}}},[t._v("+新增")])],2),a("el-form-item",{attrs:{label:"备 注："}},[a("el-input",{attrs:{type:"textarea",maxlength:"500","show-word-limit":"",rows:"3"},model:{value:t.form.remark,callback:function(e){t.$set(t.form,"remark",e)},expression:"form.remark"}})],1)],1)],1),a("div",{staticClass:"list-top"},[a("div",{staticClass:"list-top-left"},[t._v("落地载体配置")]),a("div",{staticClass:"mt15"},[a("div",{staticClass:"flex"},t._l(t.carrierList,(function(e){return a("a",{key:e.id,class:["carrier",{active:t.type===e.id}],on:{click:function(a){return t.carrierClick(e.id)}}},[t._v(t._s(e.name))])})),0),a("el-button",{attrs:{type:"primary",disabled:!!t.form.qy_qr_code_name},on:{click:function(e){t.ditchDialog=!0}}},[t._v("+匹配企微渠道")]),t.form.qy_qr_code?[a("p",{staticStyle:{margin:"16px 0"}},[t._v("企微渠道："+t._s(t.form.qy_qr_code_name))]),a("span",[t._v("渠道活码：")]),a("div",{staticClass:"code-box",attrs:{id:"qrcode"}})]:t._e(),a("p",{staticClass:"remark gray mt20"},[t._v("注：企微渠道匹配保存后，不支持修改；该渠道删除后，匹配的企微渠道可重新匹配。")])],2)]),a("div",{staticClass:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:t.saveClick}},[t._v("保 存")])],1),a("el-dialog",{attrs:{title:"匹配企微渠道",visible:t.ditchDialog,width:"500px"},on:{"update:visible":function(e){t.ditchDialog=e}}},[a("el-input",{attrs:{placeholder:"请输入内容"},model:{value:t.ditchkey,callback:function(e){t.ditchkey=e},expression:"ditchkey"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:t.getWeibanList},slot:"append"},[t._v("搜索")])],1),a("div",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:t.load,expression:"load"}],staticClass:"dialog-body",attrs:{"infinite-scroll-immediate":!1,"infinite-scroll-disabled":"disabled"}},[a("el-radio-group",{model:{value:t.qy_qr_code,callback:function(e){t.qy_qr_code=e},expression:"qy_qr_code"}},t._l(t.weibanList,(function(e,i){return a("el-radio",{key:i,attrs:{label:e.qy_qr_code,disabled:e.is_match}},[t._v(t._s(e.qy_qr_code_name)+" "),e.is_match?a("span",[t._v("已匹配")]):t._e()])})),1),t.loading?a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"tac mt10",staticStyle:{height:"30px"},attrs:{"element-loading-spinner":"el-icon-loading"}}):t._e(),t.noMore&&t.weibanList.length?a("p",{staticClass:"tac mt10"},[t._v("没有更多了~")]):t._e(),t.weibanList.length?t._e():a("p",{staticClass:"gray tac"},[t._v("没有搜索到数据")])],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.ditchDialog=!1}}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.ditchConfirm}},[t._v("确 定")])],1)],1),a("el-dialog",{attrs:{title:"渠道标签",visible:t.tagDialog,width:"500px"},on:{"update:visible":function(e){t.tagDialog=e}}},[a("div",{staticClass:"flex mb16"},[a("span",{staticStyle:{"line-height":"32px"}},[t._v("创建新标签：")]),a("el-input",{staticStyle:{width:"180px","margin-right":"10px"},attrs:{maxlength:"10",placeholder:"输入标签"},model:{value:t.newtag,callback:function(e){t.newtag=e},expression:"newtag"}}),a("el-button",{attrs:{type:"primary"},on:{click:t.addTagClick}},[t._v("添 加")])],1),t.tagList.length?a("p",[t._v("已有标签，请选择：")]):t._e(),a("div",{staticClass:"flex flex-wrap"},t._l(t.tagList,(function(e){return a("a",{key:e.tag_id,class:["tag",{active:t.tags.some((function(t){return t===e.tag_id}))}],on:{click:function(a){return t.tagClick(e.tag_id)}}},[t._v(t._s(e.name))])})),0),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.tagCancel}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.tagConfirm}},[t._v("保 存")])],1)])],1)},n=[],r=(a("c975"),a("d81d"),a("a434"),a("b0c0"),a("2909")),s=a("5530"),c=(a("96cf"),a("1da1")),o=a("d044"),l=a.n(o),d=a("2f62"),u=[{name:"企业微信",id:1},{name:"小程序",id:2},{name:"公众号",id:3},{name:"h5页面",id:4}],_={data:function(){return{id:"",type:1,carrierList:u,tagList:[],tags:[],weibanList:[],ditchkey:"",qy_qr_code:"",tag_id:"",ditchDialog:!1,tagDialog:!1,newtag:"",ditchList:[],ditchList2:[],loading:!1,page:1,size:20,total:0,form:{name:"",level1_contact_way_id:"",level2_contact_way_id:"",level1_contact_way_name:"",level2_contact_way_name:"",tag_list:[],tag_id_list:[],qy_state:"",qy_qr_code:"",qy_qr_code_name:"",remark:"",type:1},qrcode:"",rules:{name:[{required:!0,message:"请输入渠道名称",trigger:"blur"},{max:20,message:"渠道名称在20个字符以内",trigger:"blur"}],level1_contact_way_id:[{required:!0,message:"请选择一级渠道",trigger:"blur"}],level2_contact_way_id:[{required:!0,message:"请选择二级渠道",trigger:"blur"}]}}},computed:{noMore:function(){return this.page>=Math.ceil(this.total/this.size)},disabled:function(){return this.loading||this.noMore}},created:function(){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.id=t.$route.params.id||"",e.next=3,t.contactwayTree();case 3:return e.next=5,t.getTagList();case 5:t.id&&(t.form=JSON.parse(sessionStorage.getItem("form")),t.form.tag_id_list=[],t.form.type=t.type,t.form.tag_list.map((function(e){e.name&&t.form.tag_id_list.push(e.tag_id)})),t.tags=t.form.tag_id_list,t.ditchList.map((function(e){e.contact_way_id==t.form.level1_contact_way_id&&(t.ditchList2=e.list)})),console.log(t.ditchList),console.log(t.ditchList2),t.qy_qr_code=t.form.qy_qr_code,t.getCode(t.form.qy_qr_code)),t.getWeibanList();case 7:case"end":return e.stop()}}),e)})))()},methods:Object(s["a"])(Object(s["a"])({},Object(d["d"])("user",["setDitchList"])),{},{finishedTree:function(){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function e(){var a,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$api.contactway.finishedTree();case 2:a=e.sent,i=a.data,0===i.errcode&&t.setDitchList(i.data.list);case 5:case"end":return e.stop()}}),e)})))()},contactwayTree:function(){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function e(){var a,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$api.contactway.tree();case 2:a=e.sent,i=a.data,0===i.errcode&&(t.ditchList=i.data.list,t.ditchListMap());case 5:case"end":return e.stop()}}),e)})))()},ditchListMap:function(){var t=[];this.ditchList.map((function(e){e.show=!1,e.list.map((function(e){e.show=!1,e.listLength=e.list.length,t.push(e)}))})),this.activeDitch=this.ditchList[0].contact_way_id,this.ditchOption2=t,this.ditchList2=this.ditchList[0].list},changeDitch:function(t){var e=this;this.form.level2_contact_way_id="",this.ditchList.map((function(a){a.contact_way_id===t&&(e.form.level1_contact_way_name=a.name,e.ditchList2=a.list)}))},changeDitch2:function(t){var e=this;this.ditchList2.map((function(a){a.contact_way_id===t&&(e.form.level2_contact_way_name=a.name)}))},carrierClick:function(t){"1"===t?this.type=t:this.$message({type:"warning",message:"暂未开放"})},ditchConfirm:function(){var t=this;this.weibanList.map((function(e){e.qy_qr_code===t.qy_qr_code&&(t.form.qy_state=e.qy_state,t.form.qy_qr_code_name=e.qy_qr_code_name,t.form.qy_qr_code=e.qy_qr_code)})),this.getCode(this.form.qy_qr_code),this.ditchDialog=!1},tagConfirm:function(){this.form.tag_id_list=this.tags,this.tagDialog=!1},tagCancel:function(){this.tags=this.form.tag_id_list,this.tagDialog=!1},addTagClick:function(){this.newtag?(this.addTag(this.newtag),this.newtag=""):this.$message({type:"error",message:"标签不能为空"})},tagClick:function(t){this.tags.indexOf(t)>-1?this.tags.splice(this.tags.indexOf(t),1):this.tags.push(t)},handleCloseTag:function(t){this.tags.splice(this.tags.indexOf(t),1)},saveClick:function(){var t=this;this.$refs["form"].validate((function(e){return t.form.qy_qr_code?!!e&&(t.id?t.update():t.save(),void t.finishedTree()):(t.$message({type:"error",message:"未匹配企微渠道"}),!1)}))},getTagList:function(){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function e(){var a,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$api.contactway.tagList({});case 2:a=e.sent,i=a.data,0===i.errcode&&(t.tagList=i.data);case 5:case"end":return e.stop()}}),e)})))()},addTag:function(t){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function a(){var i,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,e.$api.contactway.addTag({name:t});case 2:i=a.sent,n=i.data,0===n.errcode&&e.getTagList();case 5:case"end":return a.stop()}}),a)})))()},deleteTag:function(t){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function a(){var i,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,e.$api.contactway.deleteTag({tag_id_list:[t]});case 2:i=a.sent,n=i.data,0===n.errcode&&e.getTagList();case 5:case"end":return a.stop()}}),a)})))()},getWeibanList:function(){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function e(){var a,i,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.loading=!0,e.next=3,t.$api.contactway.weibanList({page:t.page,size:t.size,search:t.ditchkey});case 3:a=e.sent,i=a.data,0===i.errcode&&((n=t.weibanList).push.apply(n,Object(r["a"])(i.data.list)),t.total=i.data.total_count),t.loading=!1;case 7:case"end":return e.stop()}}),e)})))()},update:function(){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function e(){var a,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$api.contactway.thirdLevelUpdate(t.form);case 2:a=e.sent,i=a.data,0===i.errcode&&(t.$message({type:"success",message:"保存三级渠道成功"}),t.$router.push("/ditchmgmt/index"));case 5:case"end":return e.stop()}}),e)})))()},save:function(){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function e(){var a,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$api.contactway.thirdLevelAdd(t.form);case 2:a=e.sent,i=a.data,0===i.errcode&&(t.$message({type:"success",message:"添加三级渠道成功"}),t.$router.push("/ditchmgmt/index"));case 5:case"end":return e.stop()}}),e)})))()},getCode:function(t){var e=this;this.$nextTick((function(){e.qrcode?e.qrcode.makeCode(t):e.qrcode=new l.a("qrcode",{render:"canvas",width:148,height:148,text:t,colorDark:"#000",colorLight:"#fff"})}))},load:function(){this.page++,this.getWeibanList()}})},m=_,g=(a("b10d"),a("2877")),h=Object(g["a"])(m,i,n,!1,null,"caa2e85a",null);e["default"]=h.exports}}]);