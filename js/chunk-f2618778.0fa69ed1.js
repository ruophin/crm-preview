(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f2618778"],{"129f":function(t,e){t.exports=Object.is||function(t,e){return t===e?0!==t||1/t===1/e:t!=t&&e!=e}},"7d86":function(t,e,a){"use strict";var i=a("88af"),n=a.n(i);n.a},"841c":function(t,e,a){"use strict";var i=a("d784"),n=a("825a"),c=a("1d80"),s=a("129f"),r=a("14c3");i("search",1,(function(t,e,a){return[function(e){var a=c(this),i=void 0==e?void 0:e[t];return void 0!==i?i.call(e,a):new RegExp(e)[t](String(a))},function(t){var i=a(e,t,this);if(i.done)return i.value;var c=n(t),o=String(this),l=c.lastIndex;s(l,0)||(c.lastIndex=0);var d=r(c,o);return s(c.lastIndex,l)||(c.lastIndex=l),null===d?-1:d.index}]}))},"88af":function(t,e,a){},c04f:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"patientmgmt"},[a("div",{staticClass:"header-box",staticStyle:{padding:"6px 20px"}},[a("div",{staticClass:"head-btn"},[a("el-button",{on:{click:function(e){t.drawerDitchVisible=!0}}},[t._v("一二级渠道维护")]),a("el-button",{staticStyle:{"margin-left":"20px"},attrs:{type:"primary",icon:"el-icon-plus"},on:{click:t.newDitch}},[t._v("新增三级渠道")])],1),a("el-form",{attrs:{"label-width":"auto"}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{xs:12,sm:12,md:6,lg:6,xl:6}},[a("el-form-item",{staticStyle:{"margin-bottom":"0px"}},[a("el-input",{attrs:{placeholder:"输入三级渠道名称查找"},nativeOn:{keypress:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.change(e)}},model:{value:t.search,callback:function(e){t.search="string"===typeof e?e.trim():e},expression:"search"}},[a("i",{staticClass:"el-icon-search el-input__icon",attrs:{slot:"suffix"},slot:"suffix"})])],1)],1),a("el-col",{attrs:{xs:12,sm:12,md:4,lg:4,xl:4}},[a("el-form-item",{staticStyle:{"margin-bottom":"0px"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"选择落地载体"},on:{change:t.change},model:{value:t.type,callback:function(e){t.type=e},expression:"type"}},[a("el-option",{attrs:{label:"选择落地载体",value:""}}),t._l(t.carrierList,(function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}))],2)],1)],1),a("el-col",{attrs:{xs:12,sm:12,md:4,lg:4,xl:4}},[a("el-form-item",{staticStyle:{"margin-bottom":"0px"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"选择一级渠道"},on:{change:t.changeDitch},model:{value:t.ditchId,callback:function(e){t.ditchId=e},expression:"ditchId"}},[a("el-option",{attrs:{label:"选择一级渠道",value:""}}),t._l(t.ditchList,(function(t){return a("el-option",{key:t.contact_way_id,attrs:{label:t.name,value:t.contact_way_id}})}))],2)],1)],1),a("el-col",{attrs:{xs:12,sm:12,md:4,lg:4,xl:4}},[a("el-form-item",{staticStyle:{"margin-bottom":"0px"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"选择二级渠道"},on:{change:t.change},model:{value:t.ditchId2,callback:function(e){t.ditchId2=e},expression:"ditchId2"}},[a("el-option",{attrs:{label:"选择二级渠道",value:""}}),t._l(t.ditchOption2,(function(t){return a("el-option",{key:t.contact_way_id,attrs:{label:t.name,value:t.contact_way_id}})}))],2)],1)],1),a("el-col",{staticStyle:{margin:"8px 0",float:"right"},attrs:{span:6}},[a("el-button",{staticStyle:{float:"right","margin-left":"20px"},attrs:{type:"primary"},on:{click:t.change}},[t._v("查询")]),a("el-button",{staticStyle:{float:"right"},on:{click:t.reset}},[t._v("重置")])],1)],1)],1)],1),a("div",{staticStyle:{margin:"0 16px",padding:"16px 0 0"}},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.tableLoading,expression:"tableLoading"}],ref:"elTable",attrs:{data:t.tableData,size:"small",border:"",stripe:"",height:"calc(100vh - 213px)"}},[a("el-table-column",{attrs:{type:"index",label:"序号",width:"60",align:"center",index:function(t){return t+1}}}),a("el-table-column",{attrs:{prop:"name",label:"三级渠道名称","min-width":"130"}}),a("el-table-column",{attrs:{label:"落地载体","min-width":"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.type&&t.carrierList.find((function(t){return t.id===e.row.type})).name)),a("br")]),a("span",[t._v(t._s(e.row.qy_qr_code_name||"--")),a("br")])]}}])}),a("el-table-column",{attrs:{prop:"tag_list",label:"标签","min-width":"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.tag_list.toString()?t._l(e.row.tag_list,(function(e){return a("span",{key:e.id},[t._v(t._s(e.name)),a("br")])})):a("span",[t._v("--")])]}}])}),a("el-table-column",{attrs:{label:"所属上级渠道","min-width":"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v("一级渠道："+t._s(e.row.level1_contact_way_name||"--")),a("br")]),a("span",[t._v("二级渠道："+t._s(e.row.level2_contact_way_name||"--")),a("br")])]}}])}),a("el-table-column",{attrs:{prop:"sys_create_time",label:"创建时间","min-width":"130"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.sys_create_time||"--")+" ")]}}])}),a("el-table-column",{attrs:{label:"操作",width:"110",align:"center",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-link",{attrs:{underline:!1,type:"primary"},on:{click:function(a){return t.getCode(e.row.qy_qr_code)}}},[t._v("获取渠道码")]),a("el-link",{attrs:{underline:!1,type:"primary"},on:{click:function(a){return t.edit(e.row)}}},[t._v("修改")]),a("el-link",{staticStyle:{"margin-left":"13px"},attrs:{underline:!1,type:"danger"},on:{click:function(a){return t.deleteDitch3(e.row)}}},[t._v("删除")])]}}])})],1)],1),a("div",{staticStyle:{margin:"10px 16px 0px"},attrs:{align:"right"}},[a("el-pagination",{attrs:{"current-page":t.page,"page-sizes":[20,50,100,200],"page-size":t.size,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1),a("el-dialog",{attrs:{title:"获取渠道活码",width:"500px",visible:t.dialogCodeVisible},on:{"update:visible":function(e){t.dialogCodeVisible=e}}},[a("div",{staticClass:"tac"},[a("div",{staticClass:"code-box",attrs:{id:"qrcode"}}),a("p",{staticStyle:{margin:"10px auto 30px"}},[t._v("渠道二维码")]),a("el-button",{attrs:{type:"primary"},on:{click:t.downloadCode}},[t._v("下载二维码")])],1)]),a("el-drawer",{attrs:{title:"一二级渠道维护",size:500,visible:t.drawerDitchVisible},on:{"update:visible":function(e){t.drawerDitchVisible=e}}},[a("el-row",{staticStyle:{padding:"10px"},attrs:{gutter:10}},[a("el-col",{attrs:{span:12}},[a("div",{staticClass:"box-card"},[a("div",{staticClass:"header"},[a("span",[t._v("一级渠道")])]),t._l(t.ditchList,(function(e,i){return a("div",{key:e.contact_way_id,class:["flex","j-sb","item",{blue:e.contact_way_id===t.activeDitch}],on:{click:function(a){return t.ditchClick(i,e.contact_way_id)}}},[e.show?[a("el-input",{staticClass:"w160",attrs:{placeholder:"请输入渠道名"},model:{value:e.name,callback:function(a){t.$set(e,"name",a)},expression:"item.name"}}),a("div",{staticClass:"save"},[a("a",{staticClass:"blue el-icon-circle-check",attrs:{title:"保存"},on:{click:function(a){return t.saveDitch(e,1)}}}),a("a",{staticClass:"red el-icon-circle-close ml10",attrs:{title:"取消"},on:{click:function(a){return t.cancelDitch(e,i,1)}}})])]:[a("span",{staticClass:"text-overflow w160"},[t._v(t._s(e.name))]),a("div",[a("a",{staticClass:"blue el-icon-edit-outline",attrs:{title:"编辑"},on:{click:function(a){return t.editDitch(e,1)}}}),a("a",{staticClass:"red el-icon-delete ml10",attrs:{title:"删除"},on:{click:function(a){return t.deleteDitch(i,1,e)}}})])]],2)}))],2),a("el-button",{staticClass:"mt15",attrs:{type:"primary"},on:{click:function(e){return t.addDitch(t.ditchList)}}},[t._v("新增一级渠道")])],1),a("el-col",{attrs:{span:12}},[a("div",{staticClass:"box-card"},[a("div",{staticClass:"header"},[a("span",[t._v("二级渠道")])]),t._l(t.ditchList2,(function(e,i){return a("div",{key:i,staticClass:"flex j-sb item"},[e.show?[a("el-input",{staticClass:"w160",attrs:{placeholder:"请输入渠道名"},model:{value:e.name,callback:function(a){t.$set(e,"name",a)},expression:"item.name"}}),a("div",{staticClass:"save"},[a("a",{staticClass:"blue el-icon-circle-check",attrs:{title:"保存"},on:{click:function(a){return t.saveDitch(e,2)}}}),a("a",{staticClass:"red el-icon-circle-close ml10",attrs:{title:"取消"},on:{click:function(a){return t.cancelDitch(e,i,2)}}})])]:[a("span",{staticClass:"text-overflow w135"},[t._v(t._s(e.name))]),a("span",[t._v(t._s(e.listLength))]),a("div",[a("a",{staticClass:"blue el-icon-edit-outline",attrs:{title:"编辑"},on:{click:function(a){return t.editDitch(e,2)}}}),a("a",{staticClass:"red el-icon-delete ml10",attrs:{title:"删除"},on:{click:function(a){return t.deleteDitch(i,2,e)}}})])]],2)}))],2),a("el-button",{staticClass:"mt15",attrs:{type:"primary"},on:{click:function(e){return t.addDitch(t.ditchList2)}}},[t._v("新增二级渠道")])],1)],1)],1),a("el-dialog",{attrs:{title:t.dialogDitchTit,width:"500px",visible:t.dialogDitchVisible},on:{"update:visible":function(e){t.dialogDitchVisible=e}}},[a("label",[t._v("渠道名称")]),a("el-input",{attrs:{placeholder:"请输入"}})],1)],1)},n=[],c=(a("d81d"),a("45fc"),a("a434"),a("b0c0"),a("ac1f"),a("841c"),a("96cf"),a("1da1")),s=a("5530"),r=a("2f62"),o=a("d044"),l=a.n(o),d=[{name:"企业微信",id:1},{name:"小程序",id:2},{name:"公众号",id:3},{name:"h5页面",id:4}],u=[{contact_way_id:1,level1_contact_way_name:"优呼吸互联网医院",level2_contact_way_name:"呼吸宣教室",level:3,uv:10,type:1,qy_qr_code:"sample text",qy_qr_code_name:"载体名称",name:"哮喘关爱计划单页",tag_list:["关爱计划","sdfsf"],sys_create_time:"2021-11-07 18:25:50"}],h={data:function(){return{total:0,page:1,size:20,search:"",type:"",ditchId:"",ditchId2:"",activeDitch:"",dialogDitchTit:"",tableLoading:!1,dialogCodeVisible:!1,drawerDitchVisible:!1,dialogDitchVisible:!1,carrierList:d,ditchList:[],ditchList2:[],ditchOption2:[],tableData:u,qrcode:null}},created:function(){this.getData(),this.contactwayTree()},methods:Object(s["a"])(Object(s["a"])({},Object(r["d"])("user",["setDitchList"])),{},{finishedTree:function(){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function e(){var a,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$api.contactway.finishedTree();case 2:a=e.sent,i=a.data,0===i.errcode&&t.setDitchList(i.data.list);case 5:case"end":return e.stop()}}),e)})))()},handleSizeChange:function(t){this.size=t,this.getData()},handleCurrentChange:function(t){this.page=t,this.getData()},changeDitch:function(t){var e=this;this.ditchId2="",this.ditchList.map((function(a){a.contact_way_id===t&&(e.ditchOption2=a.list)})),this.change()},getData:function(){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function e(){var a,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.tableLoading=!0,e.next=3,t.$api.contactway.thirdLevelList({page:t.page,size:t.size,search:t.search,type:t.type,level1_contact_way_id:t.ditchId,level2_contact_way_id:t.ditchId2});case 3:a=e.sent,i=a.data,0==i.errcode&&(t.tableData=i.data.list,t.total=i.data.total_count),t.tableLoading=!1;case 7:case"end":return e.stop()}}),e)})))()},addContactway:function(t,e,a){var i=this;return Object(c["a"])(regeneratorRuntime.mark((function n(){var c,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return 1===e&&(t.list=[]),n.next=3,i.$api.contactway.add({contact_way_id:a,name:t.name,level:e});case 3:if(c=n.sent,s=c.data,0!==s.errcode){n.next=10;break}t.contact_way_id=s.data.contact_way_id,1===e&&(i.activeDitch=s.data.contact_way_id),n.next=12;break;case 10:return i.$message({type:"error",message:s.errmsg}),n.abrupt("return");case 12:case"end":return n.stop()}}),n)})))()},updateContactway:function(t,e){var a=this;return Object(c["a"])(regeneratorRuntime.mark((function i(){var n,c;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,a.$api.contactway.update({name:t,contact_way_id:e});case 2:if(n=i.sent,c=n.data,0!==c.errcode){i.next=7;break}i.next=9;break;case 7:return a.$message({type:"error",message:c.errmsg}),i.abrupt("return");case 9:case"end":return i.stop()}}),i)})))()},deleteContactway:function(t,e,a){var i=this;return Object(c["a"])(regeneratorRuntime.mark((function n(){var c,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,i.$api.contactway.deleteWay({contact_way_id_list:[t],level:e});case 2:c=n.sent,s=c.data,console.log(s.errmsg),0===s.errcode&&(i.$message({type:"success",message:"删除渠道成功"}),a()),"当前渠道存在二级渠道"===s.errmsg&&i.$message({type:"error",message:"包含下级渠道，无法删除"});case 7:case"end":return n.stop()}}),n)})))()},contactwayList:function(t,e){var a=this;return Object(c["a"])(regeneratorRuntime.mark((function i(){var n,c;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,a.$api.contactway.list({level:t,contact_way_id:e});case 2:n=i.sent,c=n.data,c.errcode;case 5:case"end":return i.stop()}}),i)})))()},contactwayTree:function(){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function e(){var a,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$api.contactway.tree();case 2:a=e.sent,i=a.data,0===i.errcode&&(t.ditchList=i.data.list,t.ditchListMap());case 5:case"end":return e.stop()}}),e)})))()},ditchListMap:function(){var t=[];this.ditchList.map((function(e){e.show=!1,e.list.map((function(e){e.show=!1,e.listLength=e.list.length,t.push(e)}))})),this.activeDitch=this.ditchList[0].contact_way_id,this.ditchOption2=t,this.ditchList2=this.ditchList[0].list},changeCarrier:function(){},change:function(){this.page=1,this.getData()},getCode:function(t){var e=this;this.dialogCodeVisible=!0,this.$nextTick((function(){e.qrcode?e.qrcode.makeCode(t):e.qrcode=new l.a("qrcode",{render:"canvas",width:186,height:186,text:t,colorDark:"#000",colorLight:"#fff"})}))},downloadCode:function(){var t=document.getElementById("qrcode").childNodes[1].src,e=document.createElement("a"),a=new MouseEvent("click");e.download="code",e.href=t,e.dispatchEvent(a)},edit:function(t){sessionStorage.setItem("form",JSON.stringify(t)),this.$router.push("/ditchmgmt/edit/".concat(t.contact_way_id))},deleteDitch3:function(t){var e=this;this.$confirm("是否确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:""}).then((function(){e.deleteContactway(t.contact_way_id,3,e.getData())})).catch((function(){e.$message({type:"info",message:"已取消删除"})}))},reset:function(){this.page=1,this.search="",this.type="",this.ditchId="",this.ditchId2="",this.getData()},newDitch:function(){this.$router.push("/ditchmgmt/edit")},ditchClick:function(t,e){console.log(t),this.activeDitch=e,this.ditchList2=this.ditchList[t].list},editDitch:function(t,e){var a;1===e&&(a=this.ditchList),2===e&&(a=this.ditchList2),a.length&&a.some((function(t){return t.show}))?this.$message({type:"error",message:"请先保存"}):(t.show=!0,this.$forceUpdate(),sessionStorage.setItem("name"+t.contact_way_id,t.name))},deleteDitch:function(t,e,a){var i=this;a.listLength?this.$message({type:"error",message:"包含下级渠道，无法删除"}):this.$confirm("是否确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:""}).then((function(){1===e&&i.deleteContactway(a.contact_way_id,e,(function(){i.ditchList.splice(t,1)})),2===e&&i.deleteContactway(a.contact_way_id,e,(function(){i.ditchList2.splice(t,1)}))})).catch((function(){i.$message({type:"info",message:"已取消删除"})}))},addDitch:function(t){t.length&&t.some((function(t){return t.show}))?this.$message({type:"error",message:"请先保存"}):t.push({name:"",show:!0})},cancelDitch:function(t,e,a){var i=sessionStorage.getItem("name"+t.contact_way_id,t.name);t.contact_way_id?(t.name=i,t.show=!1,this.$forceUpdate()):(1===a&&this.ditchList.splice(e,1),2===a&&this.ditchList2.splice(e,1))},saveDitch:function(t,e){var a=sessionStorage.getItem("name"+t.contact_way_id,t.name);if(t.name)if(t.name.length>20)this.$message({type:"error",message:"渠道名称不可超过20个字"});else{if(t.show=!1,this.$forceUpdate(),t.contact_way_id){if(t.name===a)return void console.log("渠道名称没变");this.updateContactway(t.name,t.contact_way_id)}else 1===e&&this.addContactway(t,e),2===e&&this.addContactway(t,e,this.activeDitch);this.finishedTree()}else this.$message({type:"error",message:"渠道名称不可为空"})}})},p=h,m=(a("7d86"),a("2877")),f=Object(m["a"])(p,i,n,!1,null,"14693841",null);e["default"]=f.exports}}]);