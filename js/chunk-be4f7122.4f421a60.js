(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-be4f7122"],{"129f":function(e,t){e.exports=Object.is||function(e,t){return e===t?0!==e||1/e===1/t:e!=e&&t!=t}},"4f81":function(e,t,r){"use strict";r.r(t);var o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"patientmgmt"},[r("div",{staticClass:"header-box",staticStyle:{padding:"6px 20px"}},[r("el-form",{attrs:{"label-width":"auto"}},[r("el-row",{attrs:{gutter:20}},[r("el-col",{attrs:{xs:12,sm:12,md:7,lg:6,xl:6}},[r("el-form-item",{staticStyle:{"margin-bottom":"0px"}},[r("el-input",{attrs:{placeholder:"输入sn设备号/患者姓名/用户昵称/手机号查找"},nativeOn:{keypress:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.change(t)}},model:{value:e.search,callback:function(t){e.search="string"===typeof t?t.trim():t},expression:"search"}},[r("i",{staticClass:"el-icon-search el-input__icon",attrs:{slot:"suffix"},slot:"suffix"})])],1)],1),r("el-col",{attrs:{xs:12,sm:12,md:6,lg:4,xl:4}},[r("el-form-item",{staticStyle:{"margin-bottom":"0px"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{"collapse-tags":"",placeholder:"选择商品"},on:{change:e.change},model:{value:e.goods,callback:function(t){e.goods=t},expression:"goods"}},[r("el-option",{attrs:{label:"全部商品",value:""}}),e._l(e.goodsList,(function(e){return r("el-option",{key:e.goods_id,attrs:{label:e.name,value:e.goods_id}})}))],2)],1)],1),r("el-col",{attrs:{xs:12,sm:12,md:6,lg:4,xl:4}},[r("el-form-item",{staticStyle:{"margin-bottom":"0px"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{"collapse-tags":"",placeholder:"选择店铺"},on:{change:e.change},model:{value:e.shop,callback:function(t){e.shop=t},expression:"shop"}},[r("el-option",{attrs:{label:"全部店铺",value:""}}),e._l(e.storeList,(function(e){return r("el-option",{key:e.store_id,attrs:{label:e.name,value:e.store_id}})}))],2)],1)],1),r("el-col",{attrs:{xs:12,sm:12,md:6,lg:4,xl:4}},[r("el-form-item",{staticStyle:{"margin-bottom":"0px"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{"collapse-tags":"",placeholder:"选择库存状态"},on:{change:e.change},model:{value:e.status,callback:function(t){e.status=t},expression:"status"}},[r("el-option",{attrs:{label:"全部状态",value:""}}),e._l(e.statusList,(function(e){return r("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],2)],1)],1),r("el-col",{attrs:{xs:12,sm:12,md:6,lg:6,xl:4}},[r("el-form-item",{staticStyle:{"margin-bottom":"0px"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{"collapse-tags":"",placeholder:"设备新旧情况"},on:{change:e.change},model:{value:e.devices,callback:function(t){e.devices=t},expression:"devices"}},[r("el-option",{attrs:{label:"全部",value:0}}),r("el-option",{attrs:{label:"新设备",value:1}}),r("el-option",{attrs:{label:"旧设备",value:2}})],1)],1)],1),r("el-col",{staticStyle:{margin:"8px 0",float:"right"},attrs:{span:6}},[r("el-button",{staticStyle:{float:"right","margin-left":"20px"},attrs:{type:"primary"},on:{click:e.change}},[e._v("查询")]),r("el-button",{staticStyle:{float:"right"},on:{click:e.reset}},[e._v("重置")])],1)],1)],1)],1),r("div",{staticStyle:{margin:"0 16px"}},[r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],ref:"elTable",attrs:{data:e.tableData,size:"small",border:"",stripe:"",height:"calc(100vh - 202px)"}},[r("el-table-column",{attrs:{type:"index",label:"序号",width:"60",align:"center",index:function(e){return e+1}}}),r("el-table-column",{attrs:{label:"货品名称",prop:"goods_name"}}),r("el-table-column",{attrs:{label:"sn设备号",prop:"sn_num"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",[e._v(e._s(t.row.sn_num)),r("br")]),r("span",[e._v(e._s(t.row.is_out_inventory?"旧设备":"新设备"))])]}}])}),r("el-table-column",{attrs:{label:"店铺/仓库"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",{staticStyle:{"line-height":"20px",display:"inline-block","vertical-align":"middle"}},[e._v(e._s(t.row.store_name+"/"+t.row.warehouse_name))])]}}])}),r("el-table-column",{attrs:{label:"库存状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",[e._v(e._s(t.row.state&&e.statusList.find((function(e){return e.id===t.row.state})).name))])]}}])}),r("el-table-column",{attrs:{label:"库存操作信息","min-width":"205"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",[e._v("时间："+e._s(t.row.sys_create_time))]),r("br"),r("span",[e._v("操作人："+e._s(t.row.sys_create_name))])]}}])}),r("el-table-column",{attrs:{label:"用户交易信息","min-width":"260"},scopedSlots:e._u([{key:"default",fn:function(t){return[2!=t.row.state&&3!=t.row.state||!t.row.order_info?e._e():r("div",[e._v(" 用户："),r("a",{staticClass:"blue",on:{click:function(r){return e.toPage(t.row.order_info)}}},[e._v(e._s(t.row.order_info.nick_name))]),r("br"),e._v(" 患者："),r("a",{class:{blue:t.row.order_info&&t.row.order_info.patient_name},on:{click:function(r){return e.toCareprogram(t.row.order_info)}}},[e._v(" "+e._s(t.row.order_info.patient_name||"--")+" ")]),r("br"),e._v(" 手机号："+e._s(t.row.order_info.phone)),r("br"),e._v(" 支付时间："+e._s(t.row.order_info.pay_time)),r("br"),e._v(" 订单号："),r("a",{staticClass:"blue",on:{click:function(r){return e.toOrder(t.row.order_info)}}},[e._v(e._s(t.row.order_info.tid)),r("br")]),t.row.order_info&&t.row.order_info.courier_type?r("span",[e._v("物流："+e._s(3==t.row.order_info.courier_type?"中通":"顺丰")),r("br")]):e._e(),t.row.order_info&&t.row.order_info.courier_num?r("span",[e._v("物流单号："+e._s(t.row.order_info.courier_num)),r("br")]):e._e(),2==t.row.state&&t.row.front_consent_form_url&&t.row.obverse_consent_form_url?r("span",[e._v("知情同意书："),r("br")]):e._e(),2==t.row.state&&t.row.front_consent_form_url&&t.row.obverse_consent_form_url?r("div",[r("el-image",{staticStyle:{width:"100px",height:"100px",margin:"10px"},attrs:{src:t.row.front_consent_form_url,fit:"contain","preview-src-list":[t.row.front_consent_form_url]}},[r("div",{staticStyle:{"line-height":"100px","background-color":"#F3F6F9","text-align":"center",color:"#BCC0C8","font-size":"14px"},attrs:{slot:"error"},slot:"error"},[r("i",[e._v("暂无")])])]),r("el-image",{staticStyle:{width:"100px",height:"100px",margin:"10px"},attrs:{src:t.row.obverse_consent_form_url,fit:"contain","preview-src-list":[t.row.obverse_consent_form_url]}},[r("div",{staticStyle:{"line-height":"100px","background-color":"#F3F6F9","text-align":"center",color:"#BCC0C8","font-size":"14px"},attrs:{slot:"error"},slot:"error"},[r("i",[e._v("暂无")])])])],1):e._e()])]}}])}),r("el-table-column",{attrs:{label:"备注",prop:"remark"}}),r("el-table-column",{attrs:{label:"操作",width:"190",align:"center",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-link",{attrs:{underline:!1,type:"primary"},on:{click:function(r){return e.details(t.row)}}},[e._v("查看详情")]),r("el-link",{staticClass:"ml10",attrs:{underline:!1,type:"primary"},on:{click:function(r){return e.update(t.row)}}},[e._v("库存调整")]),r("el-link",{staticClass:"ml10",attrs:{underline:!1,type:"danger"},on:{click:function(r){return e.deleteGood(t.row)}}},[e._v("删除")])]}}])})],1)],1),r("div",{staticStyle:{margin:"10px 16px 0px"},attrs:{align:"right"}},[r("el-pagination",{attrs:{"current-page":e.page,"page-sizes":[20,50,100,200],"page-size":e.size,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),r("el-dialog",{attrs:{title:"库存变更记录",width:"900px",visible:e.dialogRecord},on:{"update:visible":function(t){e.dialogRecord=t}}},[r("div",[r("div",{staticClass:"flex j-sb"},[r("div",{staticStyle:{"line-height":"32px"}},[r("span",[e._v("货品名称："+e._s(e.goods_name))]),e.sn_num?r("span",{staticClass:"ml40"},[e._v("sn设备号："+e._s(e.sn_num))]):e._e()]),e.stateChangeRecords.length>1?r("el-button",{attrs:{plain:""},on:{click:e.rollbackClick}},[e._v("回退至上一状态")]):e._e()],1),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],ref:"recordTable",staticClass:"mt20",attrs:{data:e.stateChangeRecords,size:"small",border:"",stripe:"",height:"calc(100vh - 400px)"}},[r("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",[e._v(e._s(t.row.operate&&e.operateList.find((function(e){return e.id===t.row.operate})).name))])]}}])}),r("el-table-column",{attrs:{label:"操作后状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",[e._v(e._s(t.row.state&&e.statusList.find((function(e){return e.id===t.row.state})).name))])]}}])}),r("el-table-column",{attrs:{label:"店铺/仓库"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",{staticStyle:{"line-height":"20px",display:"inline-block","vertical-align":"middle"}},[e._v(e._s(t.row.store_name+"/"+t.row.warehouse_name))])]}}])}),r("el-table-column",{attrs:{label:"库存操作信息",width:"210"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("div",[r("span",[e._v("时间："+e._s(t.row.create_time))]),r("span",[e._v("操作人："+e._s(t.row.create_name))])])]}}])}),r("el-table-column",{attrs:{label:"用户交易信息",width:"260"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.order_info?[r("div",[e._v(" 用户："),r("a",{staticClass:"blue",on:{click:function(r){return e.toPage(t.row.order_info)}}},[e._v(e._s(t.row.order_info.nick_name))]),r("br"),e._v(" 患者："),r("a",{staticClass:"blue",on:{click:function(r){return e.toCareprogram(t.row.order_info)}}},[e._v(e._s(t.row.order_info.patient_name))]),r("br"),e._v(" 手机号："+e._s(t.row.order_info.phone)),r("br"),e._v(" 支付时间："+e._s(t.row.order_info.pay_time)),r("br"),e._v(" 订单号："),r("a",{staticClass:"blue",on:{click:function(r){return e.toOrder(t.row.order_info)}}},[e._v(e._s(t.row.order_info.tid)),r("br")]),t.row.order_info&&t.row.order_info.courier_type?r("span",[e._v("物流："+e._s(3==t.row.order_info.courier_type?"中通":"顺丰")),r("br")]):e._e(),t.row.order_info&&t.row.order_info.courier_num?r("span",[e._v("物流单号："+e._s(t.row.order_info.courier_num)),r("br")]):e._e(),t.row.front_consent_form_url&&t.row.obverse_consent_form_url?r("span",[e._v("知情同意书："),r("br")]):e._e(),t.row.front_consent_form_url&&t.row.obverse_consent_form_url?r("div",[r("el-image",{staticStyle:{width:"100px",height:"100px",margin:"10px"},attrs:{src:t.row.front_consent_form_url,fit:"contain","preview-src-list":[t.row.front_consent_form_url]}},[r("div",{staticStyle:{"line-height":"100px","background-color":"#F3F6F9","text-align":"center",color:"#BCC0C8","font-size":"14px"},attrs:{slot:"error"},slot:"error"},[r("i",[e._v("暂无")])])]),r("el-image",{staticStyle:{width:"100px",height:"100px",margin:"10px"},attrs:{src:t.row.obverse_consent_form_url,fit:"contain","preview-src-list":[t.row.obverse_consent_form_url]}},[r("div",{staticStyle:{"line-height":"100px","background-color":"#F3F6F9","text-align":"center",color:"#BCC0C8","font-size":"14px"},attrs:{slot:"error"},slot:"error"},[r("i",[e._v("暂无")])])])],1):e._e()])]:void 0}}],null,!0)}),r("el-table-column",{attrs:{label:"备注",prop:"remark"}})],1)],1)])],1)},n=[],a=(r("ac1f"),r("841c"),r("96cf"),r("1da1")),s=r("5530"),i=r("2f62"),l=[{name:"在库",id:1},{name:"已租赁",id:2},{name:"已销售",id:3},{name:"退货入库",id:4}],c=[{name:"采购入库",id:1},{name:"租赁出库",id:2},{name:"销售出库",id:3},{name:"退货入库",id:4},{name:"库存调整",id:5}],u={data:function(){return{total:0,page:1,size:20,search:null,status:"",shop:"",devices:"",goods:null,tableLoading:!1,tableData:[],statusList:l,operateList:c,dialogRecord:!1,stateChangeRecords:[],inventoryId:"",goods_name:"",sn_num:""}},computed:Object(s["a"])({},Object(i["c"])({storeList:"store/getStoreList",goodsList:"store/getGoodsList"})),created:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r=e.$route.query.sn_num,r&&(e.search=r),e.storeList.length){t.next=5;break}return t.next=5,e.setStoreList();case 5:if(e.goodsList.length){t.next=8;break}return t.next=8,e.setGoodsList();case 8:e.goods=parseInt(e.$route.query.goods_id)||e.goodsList[0].goods_id,e.status=parseInt(e.$route.query.status)||"",e.shop=parseInt(e.$route.query.store_id)||"",e.devices=parseInt(e.$route.query.devices)||"",e.getData();case 13:case"end":return t.stop()}}),t)})))()},methods:Object(s["a"])(Object(s["a"])({},Object(i["b"])("store",["setStoreList","setGoodsList"])),{},{handleSizeChange:function(e){this.size=e,this.getData()},handleCurrentChange:function(e){this.page=e,this.getData()},reset:function(){this.page=1,this.search=null,this.shop="",this.goods=this.goodsList[0].goods_id,this.status="",this.devices="",this.getData()},change:function(){this.page=1,this.getData()},getData:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var r,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.tableLoading=!0,t.next=3,e.$api.store.getGoodsInventoryPage({page:e.page,size:e.size,state:e.status,store_id:e.shop,goods_id:e.goods,is_out_inventory:""==e.devices?void 0:e.devices-1,find_key:e.search||null});case 3:r=t.sent,o=r.data,0==o.errcode&&(e.tableData=o.data.list,e.total=o.data.total_count),e.tableLoading=!1;case 7:case"end":return t.stop()}}),t)})))()},getGoodsStateChangeRecords:function(e){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function r(){var o,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$api.store.getGoodsStateChangeRecords(e);case 2:o=r.sent,n=o.data,0==n.errcode&&(t.stateChangeRecords=n.data);case 5:case"end":return r.stop()}}),r)})))()},deleteByInventoryId:function(e){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function r(){var o,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$api.store.deleteByInventoryId(e);case 2:o=r.sent,n=o.data,0==n.errcode&&(t.$message({type:"success",message:"删除成功"}),t.getData());case 5:case"end":return r.stop()}}),r)})))()},rollbackGoodsState:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var r,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$api.store.rollbackGoodsState(e.inventoryId);case 2:r=t.sent,o=r.data,0==o.errcode?(e.$message({type:"success",message:"已回退至上一状态"}),e.getGoodsStateChangeRecords(e.inventoryId)):e.$message({type:"error",message:o.errmsg});case 5:case"end":return t.stop()}}),t)})))()},details:function(e){this.dialogRecord=!0,this.goods_name=e.goods_name,this.sn_num=e.sn_num,this.inventoryId=e.inventory_id,this.getGoodsStateChangeRecords(e.inventory_id)},update:function(e){var t=this.$router.resolve({path:"/storage/detail/edit/".concat(e.inventory_id)}),r=t.href;window.open(r,"_blank")},deleteGood:function(e){var t=this;this.$confirm("确认删除该设备？该设备相关的所有出入库记录都将被删除","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:""}).then((function(){t.deleteByInventoryId(e.inventory_id)})).catch((function(){t.$message({type:"info",message:"已取消删除"})}))},rollbackClick:function(){var e=this;this.$confirm("是否删除最新状态回到上一状态？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:""}).then((function(){e.rollbackGoodsState()})).catch((function(){e.$message({type:"info",message:"取消操作"})}))},toPage:function(e){var t=this.$router.resolve({name:"scoreDetail",query:{id:e.user_id}}),r=t.href;window.open(r,"_blank")},toCareprogram:function(e){if(e.patient_name){sessionStorage.setItem("viewIndex",1);var t=this.$router.resolve({name:"careprogram",query:{search:e.patient_name}}),r=t.href;window.open(r,"_blank")}},toOrder:function(e){var t=this.$router.resolve({name:"ordermgmt",query:{tid:e.tid}}),r=t.href;window.open(r,"_blank")}})},d=u,_=(r("887d"),r("2877")),p=Object(_["a"])(d,o,n,!1,null,"46ee3cfa",null);t["default"]=p.exports},"841c":function(e,t,r){"use strict";var o=r("d784"),n=r("825a"),a=r("1d80"),s=r("129f"),i=r("14c3");o("search",1,(function(e,t,r){return[function(t){var r=a(this),o=void 0==t?void 0:t[e];return void 0!==o?o.call(t,r):new RegExp(t)[e](String(r))},function(e){var o=r(t,e,this);if(o.done)return o.value;var a=n(e),l=String(this),c=a.lastIndex;s(c,0)||(a.lastIndex=0);var u=i(a,l);return s(a.lastIndex,c)||(a.lastIndex=c),null===u?-1:u.index}]}))},"887d":function(e,t,r){"use strict";var o=r("eadf"),n=r.n(o);n.a},eadf:function(e,t,r){}}]);