(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-364d34ea"],{1276:function(e,t,a){"use strict";var s=a("d784"),r=a("44e7"),n=a("825a"),i=a("1d80"),c=a("4840"),l=a("8aa5"),o=a("50c4"),u=a("14c3"),d=a("9263"),p=a("d039"),_=[].push,v=Math.min,g=4294967295,h=!p((function(){return!RegExp(g,"y")}));s("split",2,(function(e,t,a){var s;return s="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,a){var s=String(i(this)),n=void 0===a?g:a>>>0;if(0===n)return[];if(void 0===e)return[s];if(!r(e))return t.call(s,e,n);var c,l,o,u=[],p=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),v=0,h=new RegExp(e.source,p+"g");while(c=d.call(h,s)){if(l=h.lastIndex,l>v&&(u.push(s.slice(v,c.index)),c.length>1&&c.index<s.length&&_.apply(u,c.slice(1)),o=c[0].length,v=l,u.length>=n))break;h.lastIndex===c.index&&h.lastIndex++}return v===s.length?!o&&h.test("")||u.push(""):u.push(s.slice(v)),u.length>n?u.slice(0,n):u}:"0".split(void 0,0).length?function(e,a){return void 0===e&&0===a?[]:t.call(this,e,a)}:t,[function(t,a){var r=i(this),n=void 0==t?void 0:t[e];return void 0!==n?n.call(t,r,a):s.call(String(r),t,a)},function(e,r){var i=a(s,e,this,r,s!==t);if(i.done)return i.value;var d=n(e),p=String(this),_=c(d,RegExp),m=d.unicode,f=(d.ignoreCase?"i":"")+(d.multiline?"m":"")+(d.unicode?"u":"")+(h?"y":"g"),y=new _(h?d:"^(?:"+d.source+")",f),b=void 0===r?g:r>>>0;if(0===b)return[];if(0===p.length)return null===u(y,p)?[p]:[];var x=0,w=0,C=[];while(w<p.length){y.lastIndex=h?w:0;var k,q=u(y,h?p:p.slice(w));if(null===q||(k=v(o(y.lastIndex+(h?0:w)),p.length))===x)w=l(p,w,m);else{if(C.push(p.slice(x,w)),C.length===b)return C;for(var U=1;U<=q.length-1;U++)if(C.push(q[U]),C.length===b)return C;w=x=k}}return C.push(p.slice(x)),C}]}),!h)},"292e2":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"basic",staticStyle:{padding:"16px"}},[a("div",{staticClass:"flex j-sb info"},[a("div",{staticClass:"flex"},[a("img",{staticStyle:{width:"90px",height:"90px","margin-right":"10px","margin-top":"18px"},attrs:{src:e.record.avatar}}),a("div",[a("p",[e._v("unionid："+e._s(e.record.union_id||"--")),a("a",{staticClass:"ml10 blue",on:{click:function(t){return e.copyText(e.record.union_id)}}},[e._v("复制")])]),a("p",[e._v("昵称："+e._s(e.record.nick_name||"--"))]),a("p",[e._v("手机号："+e._s(e.record.phone||"--")),a("a",{staticClass:"ml10 blue",on:{click:function(t){return e.copyText(e.record.phone)}}},[e._v("复制")])])])]),a("div",[a("p",[e._v(" 企微好友："+e._s(e.record.subscribe_qywx?"已添加":"未添加")+"("+e._s(e.record.qy_userid||"--")+") ")]),a("p",[e._v("哮喘管家："+e._s(e.record.subscribe_miniapp?"已注册":"未注册"))]),a("p",[e._v(" 服务号："+e._s(e.record.subscribe_official_account?"已关注":"未关注")+" ")])]),a("div",[a("p",[e._v("添加好友时间："+e._s(e.record.subscribe_qywx_time||"--"))]),a("p",[e._v("用户注册时间："+e._s(e.record.subscribe_miniapp_time||"--"))]),a("p",[e._v("首次建档时间："+e._s(e.record.first_filing_time||"--"))])]),a("div",[a("el-button",{attrs:{type:"primary",plain:""},on:{click:e.sendMessage}},[e._v("推送启动消息")])],1)]),a("p",{staticStyle:{"margin-left":"100px"}},[e._v(" 渠道信息："+e._s(e.record.contact_way||"--")+" ")])]),a("div",{staticClass:"shop-info"},[a("div",{staticClass:"info-title"},[a("span",[e._v("消费信息")]),a("el-button",{attrs:{type:"text"},on:{click:e.pushAllOrderClick}},[e._v("查看所有订单")])],1),a("div",{staticClass:"flex info-data"},[a("div",[a("span",[e._v("实际消费金额（元）")]),a("span",[e._v(e._s(e.record.actual_fee||"--"))])]),a("div",[a("span",[e._v("累计消费金额（元）")]),a("span",[e._v(e._s(e.record.total_fee||"--"))])]),a("div",[a("span",[e._v("累计消费订单数")]),a("span",[e._v(e._s(e.record.order_total||"--"))])]),a("div",[a("span",[e._v("最近下单时间")]),a("span",[e._v(e._s(e.record.last_time||"--"))])]),a("div",[a("span",[e._v("累计退款金额（元）")]),a("span",[e._v(e._s(e.record.refund_fee||"--"))])]),a("div",[a("span",[e._v("累计退款订单数")]),a("span",[e._v(e._s(e.record.refund_total||"--"))])])])]),a("div",{staticClass:"wrap"},[e._m(0),a("div",{staticClass:"content"},[a("div",{staticClass:"flex j-sb score-wrap"},[a("div",[a("p",[e._v("余额")]),a("p",{staticClass:"blue"},[a("span",[e._v(e._s(e.record.score||0))])])]),a("div",[a("p",[e._v("历史")]),a("p",[e._v(" 获取 "),a("span",{staticClass:"blue"},[e._v(e._s(e.record.history_acquire_score||0))])]),a("p",[e._v(" 使用 "),a("span",{staticClass:"gray"},[e._v(e._s(e.record.history_use_score||0))])])]),a("div",[a("p",[e._v("今日")]),a("p",[e._v(" 获取 "),a("span",{staticClass:"blue"},[e._v(e._s(e.record.today_acquire_score||0))])]),a("p",[e._v(" 使用 "),a("span",{staticClass:"gray"},[e._v(e._s(e.record.today_use_score||0))])])]),a("div",[a("p",[e._v("昨日")]),a("p",[e._v(" 获取 "),a("span",{staticClass:"blue"},[e._v(e._s(e.record.yesterday_acquire_score||0))])]),a("p",[e._v(" 使用 "),a("span",{staticClass:"gray"},[e._v(e._s(e.record.yesterday_use_score||0))])])]),a("div",[a("p",[e._v("本周")]),a("p",[e._v(" 获取 "),a("span",{staticClass:"blue"},[e._v(e._s(e.record.week_acquire_score||0))])]),a("p",[e._v(" 使用 "),a("span",{staticClass:"gray"},[e._v(e._s(e.record.week_use_score||0))])])]),a("div",[a("p",[e._v("上一周")]),a("p",[e._v(" 获取 "),a("span",{staticClass:"blue"},[e._v(e._s(e.record.lastweek_acquire_score||0))])]),a("p",[e._v(" 使用 "),a("span",{staticClass:"gray"},[e._v(e._s(e.record.lastweek_use_score||0))])])]),a("div",[a("p",[e._v("本月")]),a("p",[e._v(" 获取 "),a("span",{staticClass:"blue"},[e._v(e._s(e.record.month_acquire_score||0))])]),a("p",[e._v(" 使用 "),a("span",{staticClass:"gray"},[e._v(e._s(e.record.month_use_score||0))])])]),a("div",[a("p",[e._v("上一月")]),a("p",[e._v(" 获取 "),a("span",{staticClass:"blue"},[e._v(e._s(e.record.lastmonth_acquire_score||0))])]),a("p",[e._v(" 使用 "),a("span",{staticClass:"gray"},[e._v(e._s(e.record.lastmonth_use_score||0))])])])]),a("div",{staticClass:"header-box",staticStyle:{padding:"6px 20px"}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"daterange",align:"right","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":e.pickerOptions},on:{change:e.searchFn},model:{value:e.dateRange,callback:function(t){e.dateRange=t},expression:"dateRange"}})],1),a("el-col",{attrs:{span:6}},[a("el-select",{staticStyle:{width:"100%"},on:{change:e.searchFn},model:{value:e.patientId,callback:function(t){e.patientId=t},expression:"patientId"}},[a("el-option",{attrs:{label:"全部成员",value:""}}),e._l(e.patientList,(function(e){return a("el-option",{key:e.patient_id,attrs:{label:e.name,value:e.patient_id}})}))],2)],1),a("el-col",{attrs:{span:6}},[a("el-select",{staticStyle:{width:"100%"},on:{change:e.searchFn},model:{value:e.type,callback:function(t){e.type=t},expression:"type"}},[a("el-option",{attrs:{label:"出入类型",value:""}}),a("el-option",{attrs:{label:"获取",value:1}}),a("el-option",{attrs:{label:"使用",value:0}})],1)],1),a("el-col",{attrs:{span:4}},[a("el-checkbox",{staticStyle:{"vertical-align":"-6px"},on:{change:e.searchFn},model:{value:e.signUp,callback:function(t){e.signUp=t},expression:"signUp"}},[e._v("每日签到")])],1)],1)],1),a("div",{staticStyle:{margin:"0 16px","padding-top":"11px"}},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],attrs:{data:e.tableData,size:"small",border:"",stripe:"",height:"calc(100vh - 475px)"}},[a("el-table-column",{attrs:{type:"index",label:"序号",width:"60",align:"center",index:function(t){return(e.page-1)*e.size+t+1}}}),a("el-table-column",{attrs:{label:"记录"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.title)),a("br")]),void 0!==t.row.goodsName?a("span",{staticClass:"gray"},[e._v("商品："+e._s(t.row.goodsName)),a("br")]):e._e(),"签到"!==t.row.title&&null!==t.row.patient_name?a("span",{staticClass:"gray"},[e._v("成员："+e._s(t.row.patient_name))]):e._e()]}}])}),a("el-table-column",{attrs:{label:"时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticClass:"gray"},[e._v(e._s(t.row.sys_create_time))])]}}])}),a("el-table-column",{attrs:{label:"健康分"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{class:{blue:t.row.type,gray:!t.row.type}},[e._v(e._s(t.row.type?"+":"")+e._s(t.row.score))])]}}])})],1)],1),a("div",{staticStyle:{margin:"10px 16px 0px"},attrs:{align:"right"}},[a("el-pagination",{attrs:{"current-page":e.page,"page-sizes":[20,50,100,200],"page-size":e.size,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)])]),a("el-dialog",{attrs:{width:"660px",visible:e.dialogMsgVisible},on:{"update:visible":function(t){e.dialogMsgVisible=t}}},[a("div",{attrs:{slot:"title"},slot:"title"},[e._v(" 推送启动消息 "),a("el-button",{staticClass:"ml10",attrs:{size:"mini",icon:"el-icon-refresh"},on:{click:e.getQueryUser}},[e._v("刷新")])],1),a("div",[a("p",{staticClass:"tt"},[e._v("当前疗程设备情况")]),a("el-radio-group",{model:{value:e.queryUser.device_status,callback:function(t){e.$set(e.queryUser,"device_status",t)},expression:"queryUser.device_status"}},[a("el-radio",{attrs:{label:1}},[e._v("租赁的设备")]),a("el-radio",{attrs:{label:2}},[e._v("购买的设备")])],1),a("div",{staticClass:"mt15"},[a("el-button",{attrs:{type:e.record.subscribe_official_account?"primary":"info",disabled:!e.record.subscribe_official_account,plain:""},on:{click:e.startPushMessage}},[e._v(e._s(2!==e.queryUser.device_status?"推送知情同意书":"推送启动确认函"))]),e.record.subscribe_official_account?e._e():a("span",{staticClass:"red ml10"},[e._v("未关注公众号")])],1),e.queryUser.device_status===e.device_status?[e.queryUser.push_name?a("div",{staticClass:"mt10"},[a("el-tag",{staticStyle:{width:"82px","text-align":"center"},attrs:{type:"success",effect:"dark"}},[e._v("已推送")]),a("span",{staticClass:"gray ml10",staticStyle:{"font-size":"14px"}},[e._v("推送人："+e._s(e.queryUser.push_name)+" "+e._s(e.queryUser.push_time))])],1):e._e(),e.queryUser.push_name&&!e.queryUser.confirm||e.dayjs(e.queryUser.push_time)>e.dayjs(e.queryUser.confirm_time)?a("div",{staticClass:"mt10"},[a("el-tag",{attrs:{type:"info"}},[e._v("用户未确认")])],1):e._e(),e.queryUser.confirm&&e.dayjs(e.queryUser.push_time)<e.dayjs(e.queryUser.confirm_time)?a("div",{staticClass:"mt10"},[a("el-tag",{attrs:{type:"success",effect:"dark"}},[e._v("用户已确认")]),a("span",{staticClass:"gray ml10",staticStyle:{"font-size":"14px"}},[e._v("确认时间："+e._s(e.queryUser.confirm_time))]),a("a",{staticClass:"blue ml10",on:{click:e.showContract}},[e._v("查看详情")])],1):e._e()]:e._e()],2)]),a("careplan-contract",{ref:"careplanContract"}),a("input",{staticStyle:{position:"absolute",left:"-999px"},attrs:{type:"text",id:"input"}})],1)},r=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"info-title"},[a("span",[e._v("健康分")])])}],n=(a("d81d"),a("ac1f"),a("1276"),a("5530")),i=(a("96cf"),a("1da1")),c=a("5a0c"),l=a.n(c),o=a("d772"),u=a.n(o),d=a("7d20"),p=a("74fe");l.a.extend(u.a);var _={components:{CareplanContract:p["a"]},data:function(){return{record:{},userId:"",activeName:"3",signUp:"",tableLoading:!1,tableData:[],dateRange:[],patientList:[],patientId:"",type:"",page:1,size:20,total:0,pickerOptions:d["a"],dialogMsgVisible:!1,start_info:{},device_status:"",queryUser:{confirm:!0,confirm_time:"",push_name:"",push_time:"",device_status:"",plan_id:""},dayjs:l.a}},created:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.userId=e.$route.query.id,e.getData(),e.getPatientList(),e.getQueryUser();case 4:case"end":return t.stop()}}),t)})))()},methods:{handleSizeChange:function(e){this.size=e,this.getRecordList()},handleCurrentChange:function(e){this.page=e,this.getRecordList()},searchFn:function(){this.page=1,this.getRecordList()},getData:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$api.score.detail(e.userId);case 2:a=t.sent,s=a.data,0==s.errcode&&(e.record=s.data),console.log(e.record);case 6:case"end":return t.stop()}}),t)})))()},getRecordList:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a,s,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.tableLoading=!0,t.next=3,e.$api.score.recordList({patient_id:e.patientId,page:e.page,size:e.size,start_time:e.dateRange&&e.dateRange.length?l()(e.dateRange[0]).format("YYYY-MM-DD")+" 00:00:00":"",end_time:e.dateRange&&e.dateRange.length?l()(e.dateRange[1]).format("YYYY-MM-DD")+" 23:59:59":"",type:e.type,day_sign:e.signUp?1:"",user_id:e.userId});case 3:a=t.sent,s=a.data,0==s.errcode&&(r=s.data.records.map((function(e){var t=e.title.split("&&&"),a=t.length>1?t[1]:void 0;return Object(n["a"])(Object(n["a"])({},e),{},{title:t[0],goodsName:a})})),e.tableData=r,e.total=s.data.total),e.tableLoading=!1;case 7:case"end":return t.stop()}}),t)})))()},getPatientList:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$api.to_doList.bindpatient_userId(e.userId);case 2:a=t.sent,s=a.data,0==s.errcode&&(e.patientList=s.data.list,e.getRecordList());case 5:case"end":return t.stop()}}),t)})))()},getQueryUser:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$api.patientmgmt.queryUser(e.userId);case 2:a=t.sent,s=a.data,0==s.errcode&&(e.queryUser=s.data,e.device_status=s.data.device_status,e.queryUser.device_status=e.queryUser.device_status||1);case 5:case"end":return t.stop()}}),t)})))()},sendMessage:function(){this.dialogMsgVisible=!0},startPushMessage:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.queryUser.device_status){t.next=3;break}return e.$message({type:"error",message:"请选择当前疗程设备情况"}),t.abrupt("return");case 3:return t.prev=3,t.next=6,e.$api.patientmgmt.startPushMessage({user_id:e.userId,device_status:e.queryUser.device_status});case 6:a=t.sent,s=a.data,0==s.errcode&&(e.$message({message:"推送成功",type:"success"}),e.getQueryUser()),t.next=14;break;case 11:t.prev=11,t.t0=t["catch"](3),console.log(t.t0);case 14:case"end":return t.stop()}}),t,null,[[3,11]])})))()},joinMessage:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var s,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.$api.patientmgmt.joinMessage({open_id:e});case 2:s=a.sent,r=s.data,0==r.errcode&&t.$message({message:"推送成功",type:"success"});case 5:case"end":return a.stop()}}),a)})))()},copyText:function(e){var t=document.getElementById("input");t.value=e,t.select(),document.execCommand("Copy"),this.$message({type:"success",message:"复制成功"})},showContract:function(){this.$refs.careplanContract.dialogVisible=!0,this.$refs.careplanContract.getQueryCurrent(this.queryUser.plan_id,this.queryUser.device_status)},pushAllOrderClick:function(){var e=this.$router.resolve({name:"ordermgmt",query:{phone:this.record.phone}}),t=e.href;window.open(t,"_blank")}}},v=_,g=(a("8998"),a("2877")),h=Object(g["a"])(v,s,r,!1,null,"1a48c36e",null);t["default"]=h.exports},"2da8":function(e,t,a){},8998:function(e,t,a){"use strict";var s=a("2da8"),r=a.n(s);r.a}}]);