(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ed6eef6a"],{1266:function(t,e,a){},"12cb":function(t,e,a){},"75f2":function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"caredetails"},[a("div",{staticClass:"list-top"},[a("div",{staticClass:"list-top-left"},[t._v("基础信息")]),Object.keys(t.record).length?a("div",{staticClass:"flex j-sb info"},[a("div",[a("p",[t._v(" 患者信息："+t._s(t.record.name)+" "+t._s(1===t.record.sex?"女":0===t.record.sex?"男":"--")+" / "+t._s(t.record.age)+"岁 ")]),a("p",[t._v("用户昵称："+t._s(t.record.nickname||"--"))]),a("p",[t._v("状态："+t._s(t.record.mgmt_status?"已入组":"未入组"))]),a("p",[t._v("绑定设备："+t._s(t.care_plan.goods_name||"--"))])]),a("div",[a("p",[t._v("门诊号："+t._s(t.record.menzhen_number||"--"))]),a("p",[t._v("手机号："+t._s(t.record.phone||"--"))]),a("p",[t._v("管理医生："+t._s(t.record.contract_doctor_name||"--"))]),a("p",[t._v("SN码："+t._s(t.care_plan.sn_num||"--"))])]),a("div",[a("p",[t._v("身份证号："+t._s(t.record.id_card||"--"))]),a("p",[t._v("与患者关系："+t._s(t.record.relation||"--"))]),a("p",[t._v("医院："+t._s(t.record.dept_name||"--"))]),a("p",[t._v("租售情况："+t._s(t.care_plan.goods_state?t.goods_state[t.care_plan.goods_state-1]:"--"))])]),a("div",[t.nextBtnVisible?a("el-button",{attrs:{type:"primary",plain:""},on:{click:function(e){t.dialogNextVisible=!0}}},[t._v("启动下一个疗程")]):t._e(),t.care_plan.start_next_flag&&!t.nextBtnVisible?a("el-button",{attrs:{type:"success",plain:""},on:{click:function(e){t.dialogNextVisible=!0}}},[t._v("已启动下一个疗程")]):t._e()],1)]):t._e()]),t.care_plan_list.length>1?a("el-radio-group",{staticStyle:{padding:"16px 16px 10px"},attrs:{size:"small"},on:{change:t.changeCarePlan},model:{value:t.carePlanNumber,callback:function(e){t.carePlanNumber=e},expression:"carePlanNumber"}},t._l(t.care_plan_list,(function(e){return a("el-radio-button",{key:e.plan_id,attrs:{label:e.number}},[t._v("第"+t._s(e.number)+"疗程")])})),1):t._e(),a("div",{staticClass:"card"},[1==t.carePlanNumber?a("div",{staticClass:"list-top-left"},[t._v(" 知情同意书信息 ")]):t._e(),1==t.carePlanNumber?a("div",[a("el-image",{staticStyle:{width:"100px",height:"100px",margin:"10px"},attrs:{src:t.care_plan.front_consent_form_url,fit:"contain","preview-src-list":[t.care_plan.front_consent_form_url]}},[a("div",{staticStyle:{"line-height":"100px","background-color":"#F3F6F9","text-align":"center",color:"#BCC0C8","font-size":"14px"},attrs:{slot:"error"},slot:"error"},[a("i",[t._v("暂无")])])]),a("el-image",{staticStyle:{width:"100px",height:"100px",margin:"10px"},attrs:{src:t.care_plan.obverse_consent_form_url,fit:"contain","preview-src-list":[t.care_plan.obverse_consent_form_url]}},[a("div",{staticStyle:{"line-height":"100px","background-color":"#F3F6F9","text-align":"center",color:"#BCC0C8","font-size":"14px"},attrs:{slot:"error"},slot:"error"},[a("i",[t._v("暂无")])])])],1):t._e(),a("div",{staticClass:"list-top-left"},[t._v(" "+t._s(t.care_plan.start_time&&t.care_plan.start_time.split(" ")[0])+" 至 "+t._s(t.care_plan.end_time&&t.care_plan.end_time.split(" ")[0])+" 第"),a("span",{staticClass:"blue"},[t._v(t._s(t.care_plan.days>0?t.care_plan.days:0))]),t._v("天 "),t.finishStep<=6&&(1==t.care_plan.status||4==t.care_plan.status)?a("el-button",{staticClass:"ml20",attrs:{type:"danger",plain:""},on:{click:function(e){t.dialogCourseVisible=!0}}},[t._v("结束疗程")]):t._e(),t.finishStep>1&&t.finishStep<=5&&1==t.care_plan.device_status||t.finishStep<=2&&2==t.care_plan.device_status?a("span",{staticClass:"gray f14 mt10 ml10 lh20 tac"},[t._v(" 审核中 ")]):t._e(),2==t.care_plan.status||3==t.care_plan.status?[a("span",{staticClass:"gray f14 ml10 lh20 tac"},[t._v("疗程已结束 "+t._s(t.care_plan.actual_end_time&&t.care_plan.actual_end_time.split(" ")[0]||t.care_plan.end_time.split(" ")[0]))]),t.finishStep<6?a("el-button",{staticClass:"ml10",on:{click:function(e){t.dialogCourseVisible=!0}}},[t._v("登记疗程信息")]):a("el-button",{staticClass:"ml10",on:{click:function(e){t.dialogCourseVisible=!0}}},[t._v("查看登记信息")])]:t._e(),a("a",{staticClass:"blue",staticStyle:{float:"right","line-height":"32px"},on:{click:function(e){return t.showContract(t.care_plan.device_status||1)}}},[t._v("查看详情")])],2),a("el-row",{staticStyle:{margin:"18px 0 8px"},attrs:{gutter:20}},[a("el-col",{staticClass:"tac",attrs:{xs:12,sm:8,md:8,lg:5,xl:4}},[a("el-progress",{class:t.care_plan.pef_qualified_rate>=90?"blue":t.care_plan.pef_qualified_rate>=80&&t.care_plan.pef_qualified_rate<90?"orange":null==t.care_plan.pef_qualified_rate?"":"red",attrs:{type:"circle",percentage:Number(t.care_plan.pef_qualified_rate)||0,"stroke-width":25,color:null==t.care_plan.pef_qualified_rate?"#333":t.care_plan.pef_qualified_rate>=90?"#13C2C2":t.care_plan.pef_qualified_rate>=80&&t.care_plan.pef_qualified_rate<90?"#FD9741":"#FF143E"}}),a("p",{staticClass:"mt10"},[t._v("日间PEF达标率")])],1),a("el-col",{staticClass:"tac",attrs:{xs:12,sm:8,md:8,lg:5,xl:4}},[a("el-progress",{ref:"pefProgress",class:t.care_plan.drug_qualified_rate>=90?"blue":t.care_plan.drug_qualified_rate>=80&&t.care_plan.drug_qualified_rate<90?"orange":null==t.care_plan.drug_qualified_rate?"":"red",attrs:{type:"circle",percentage:Number(t.care_plan.drug_qualified_rate)||0,"stroke-width":25,color:t.care_plan.drug_qualified_rate>=90?"#13C2C2":t.care_plan.drug_qualified_rate>=80&&t.care_plan.drug_qualified_rate<90?"#FD9741":"#FF143E"}}),a("p",{staticClass:"mt10"},[t._v("每日用药达标率")])],1),a("el-col",{staticClass:"tac",attrs:{xs:12,sm:8,md:8,lg:5,xl:4}},[a("el-progress",{class:100==t.care_plan.followup_qualified_rate?"blue":null==t.care_plan.followup_qualified_rate?"":"red",attrs:{type:"circle",percentage:Number(t.care_plan.followup_qualified_rate)||0,"stroke-width":25,color:100==t.care_plan.followup_qualified_rate?"#13C2C2":"#FF143E"}}),a("p",{staticClass:"mt10"},[t._v("随访服务达标率")])],1)],1)],1),a("el-radio-group",{staticStyle:{padding:"16px 16px 10px"},attrs:{size:"small"},on:{change:t.changeViewIndex},model:{value:t.viewIndex,callback:function(e){t.viewIndex=e},expression:"viewIndex"}},[a("el-radio-button",{attrs:{label:2}},[t._v("哮喘日记未记录情况")]),a("el-radio-button",{attrs:{label:3}},[t._v("随访服务未完成情况")])],1),a("div",{staticStyle:{padding:"10px 16px",background:"#fff"}},[a("el-table",{ref:"elTable",staticStyle:{width:"100%"},attrs:{data:t.tableData,size:"small",border:"",stripe:""}},[a("el-table-column",{attrs:{type:"index",label:"序号",width:"60",align:"center",index:function(e){return(t.page-1)*t.size+e+1}}}),2==t.viewIndex?a("el-table-column",{attrs:{prop:"date",label:"未记录日期"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.date&&e.row.date.split(" ")[0])+" ")]}}],null,!1,1888667826)}):t._e(),2==t.viewIndex?a("el-table-column",{attrs:{label:"未记录事项"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.pef_recorded?t._e():a("span",[t._v("日间PEF"),a("br")]),e.row.drug_recorded?t._e():a("span",[t._v("每日用药")])]}}],null,!1,3320570921)}):t._e(),3==t.viewIndex?a("el-table-column",{attrs:{label:"未完成任务"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.plan_title)+" ")]}}],null,!1,2041416433)}):t._e(),3==t.viewIndex?a("el-table-column",{attrs:{label:"推送日期"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.task_date&&e.row.task_date.split(" ")[0])+" , "+t._s(e.row.node_name)+" ")]}}],null,!1,1592254223)}):t._e(),a("el-table-column",{attrs:{label:"状态"},scopedSlots:t._u([{key:"default",fn:function(e){return[2==t.viewIndex?[e.row.has_expire?a("span",[t._v("不可补录")]):[a("span",[t._v("可补录"),a("br")]),e.row.remain_days>0?a("span",[t._v("逾期第"+t._s(e.row.remain_days)+"天")]):t._e()]]:t._e(),3==t.viewIndex?[e.row.expire_time?e.row.has_expire?a("span",[t._v("已失效")]):[a("span",[t._v("未失效"),a("br")]),e.row.remain_days>0?a("span",[t._v("逾期第"+t._s(e.row.remain_days)+"天")]):t._e()]:a("span",[t._v("--")])]:t._e()]}}])}),a("el-table-column",{attrs:{label:"操作",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[2==t.viewIndex?[e.row.has_expire?t._e():[e.row.qy_user_sent?a("el-link",{attrs:{disabled:"",underline:!1}},[t._v("已提醒")]):a("el-link",{attrs:{underline:!1,type:"primary"},on:{click:function(a){return t.remind(e.row,1)}}},[t._v("提醒")])]]:t._e(),3==t.viewIndex?[e.row.has_expire?t._e():[e.row.qy_user_sent?a("el-link",{attrs:{disabled:"",underline:!1}},[t._v("已提醒")]):a("el-link",{attrs:{underline:!1,type:"primary"},on:{click:function(a){return t.remind(e.row,2)}}},[t._v("提醒")])]]:t._e()]}}])})],1)],1),a("el-dialog",{attrs:{width:"660px",visible:t.dialogCourseVisible},on:{"update:visible":function(e){t.dialogCourseVisible=e}}},[a("div",{attrs:{slot:"title"},slot:"title"},[t._v(" 申请结束疗程 "),t.finishStep<6?a("el-button",{staticClass:"ml10",attrs:{size:"mini",icon:"el-icon-refresh"},on:{click:t.getCarePlan}},[t._v("刷新")]):t._e()],1),a("div",[a("el-steps",{attrs:{direction:"vertical",active:t.finishStep}},[a("el-step",[a("p",{staticClass:"tt",attrs:{slot:"title"},slot:"title"},[t._v(" 申请结束疗程 "),t.review_workflow&&t.review_workflow.length>0?a("span",[t._v(t._s(t.review_workflow[0].actionTime)+" "+t._s(t.review_workflow[0].executor))]):t._e()]),a("template",{slot:"description"},[1==t.care_plan.status||3==t.care_plan.status||4==t.care_plan.status?a("el-checkbox",{staticClass:"mt10",attrs:{disabled:t.finishStep>0},model:{value:t.finishCourse,callback:function(e){t.finishCourse=e},expression:"finishCourse"}},[t._v("确认提前结束疗程")]):t._e(),2==t.care_plan.status?a("p",{staticClass:"black mt10",staticStyle:{"font-size":"14px"}},[t._v("日间PEF达标率："),a("span",{class:{mr10:!0,"light-blue":t.care_plan.pef_qualified_rate>=90,orange:t.care_plan.pef_qualified_rate>=80&&t.care_plan.pef_qualified_rate<90,red:t.care_plan.pef_qualified_rate&&t.care_plan.pef_qualified_rate<80}},[t._v(t._s(t.care_plan.pef_qualified_rate||"--")+t._s(t.care_plan.pef_qualified_rate&&"%"))]),t._v(" 每日用药达标率："),a("span",{class:{mr10:!0,"light-blue":t.care_plan.drug_qualified_rate>=90,orange:t.care_plan.drug_qualified_rate>=80&&t.care_plan.drug_qualified_rate<90,red:t.care_plan.drug_qualified_rate&&t.care_plan.drug_qualified_rate<80}},[t._v(t._s(t.care_plan.drug_qualified_rate||"--")+t._s(t.care_plan.drug_qualified_rate&&"%"))]),t._v(" 随访服务达标率："),a("span",{class:{"light-blue":100==t.care_plan.followup_qualified_rate,red:t.care_plan.followup_qualified_rate&&t.care_plan.followup_qualified_rate<100}},[t._v(t._s(t.care_plan.followup_qualified_rate||"--")+t._s(t.care_plan.followup_qualified_rate&&"%"))])]):t._e(),a("div",{staticClass:"flex js-b mt10"},[a("label",{staticStyle:{width:"130px","font-weight":"normal","line-height":"34px"}},[t._v("当前疗程设备情况：")]),a("el-radio-group",{attrs:{disabled:t.finishStep>0},model:{value:t.care_plan.device_status,callback:function(e){t.$set(t.care_plan,"device_status",e)},expression:"care_plan.device_status"}},[a("el-radio",{attrs:{label:1}},[t._v("租赁的设备")]),a("el-radio",{attrs:{label:2}},[t._v("购买的设备")])],1)],1),a("div",{staticClass:"flex js-b mt10"},[a("label",{staticStyle:{width:"50px","font-weight":"normal"}},[t._v("备注：")]),a("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:"请输入内容",disabled:6===t.finishStep},model:{value:t.care_plan.remark,callback:function(e){t.$set(t.care_plan,"remark",e)},expression:"care_plan.remark"}})],1)],1)],2),2!==t.care_plan.device_status?[a("el-step",[a("p",{staticClass:"tt",attrs:{slot:"title"},slot:"title"},[t._v(" 设备退还情况 "),t.review_workflow&&t.review_workflow.length>1?a("span",[t._v(t._s(t.review_workflow[1].actionTime)+" "+t._s(t.review_workflow[1].executor))]):t._e()]),a("template",{slot:"description"},[a("div",{staticClass:"flex js-b mt10"},[a("span",[t._v(t._s(t.care_plan.goods_name||"--")+t._s(t.care_plan.goods_name?"：":"")+t._s(t.care_plan.sn_num?t.care_plan.sn_num:""))])]),a("el-radio-group",{attrs:{disabled:1!==t.finishStep},model:{value:t.care_plan.device_return,callback:function(e){t.$set(t.care_plan,"device_return",e)},expression:"care_plan.device_return"}},[a("el-radio",{attrs:{label:"1"}},[t._v("完好退还")]),a("el-radio",{attrs:{label:"2"}},[t._v("有损退还")]),a("el-radio",{attrs:{label:"3"}},[t._v("不退还")])],1)],1)],2),a("el-step",[a("p",{staticClass:"tt",attrs:{slot:"title"},slot:"title"},[t._v(" 租金核算 "),t.review_workflow&&t.review_workflow.length>2?a("span",[t._v(t._s(t.review_workflow[2].actionTime)+" "+t._s(t.review_workflow[2].executor))]):t._e()]),a("template",{slot:"description"},[a("div",{staticClass:"flex js-b mt10"},[a("label",{staticStyle:{width:"80px","line-height":"32px","font-weight":"normal"}},[t._v("核算金额：")]),a("el-input",{staticStyle:{width:"140px"},attrs:{suffix:"元",type:"text",disabled:t.finishStep<2||6===t.finishStep},model:{value:t.care_plan.return_money,callback:function(e){t.$set(t.care_plan,"return_money",e)},expression:"care_plan.return_money"}},[t._t("default",[t._v("元")],{slot:"suffix"})],2)],1)])],2),a("el-step",[a("p",{staticClass:"tt",attrs:{slot:"title"},slot:"title"},[t._v(" 与用户确认方式 "),t.review_workflow&&t.review_workflow.some((function(t){return 4==t.action}))?a("span",[t._v(t._s(t.review_workflow.find((function(t){return 4==t.action})).actionTime)+" "+t._s(t.review_workflow.find((function(t){return 4==t.action})).executor))]):t._e()]),a("template",{slot:"description"},[a("div",{staticClass:"flex js-b mt10"},[a("label",{staticStyle:{width:"80px","line-height":"32px","font-weight":"normal"}},[t._v("确认金额：")]),a("el-input",{staticStyle:{width:"140px"},attrs:{suffix:"元",type:"text",disabled:t.finishStep<3||6===t.finishStep},on:{change:function(e){t.care_plan.push=!1}},model:{value:t.care_plan.confirm_money,callback:function(e){t.$set(t.care_plan,"confirm_money",e)},expression:"care_plan.confirm_money"}},[t._t("default",[t._v("元")],{slot:"suffix"})],2)],1),a("el-radio-group",{attrs:{disabled:3!==t.finishStep},model:{value:t.care_plan.confirm_letter,callback:function(e){t.$set(t.care_plan,"confirm_letter",e)},expression:"care_plan.confirm_letter"}},[a("el-radio",{attrs:{label:!0}},[t._v("确认函")]),a("el-radio",{attrs:{label:!1}},[t._v("无需确认")])],1),t.care_plan.confirm_letter?[t.care_plan.push?t._e():a("div",{staticClass:"mt10"},[a("el-button",{attrs:{type:"primary",plain:"",disabled:!t.isFollow||t.finishStep<3||6===t.finishStep},on:{click:t.pushMessage}},[t._v("推送确认函")]),t.isFollow||3!==t.finishStep?t._e():a("span",{staticClass:"red ml10"},[t._v("未关注公众号")])],1),t.care_plan.push?a("div",{staticClass:"mt10"},[a("el-tag",{staticStyle:{width:"82px","text-align":"center"},attrs:{type:"success",effect:"dark"}},[t._v("已推送")]),t.review_workflow&&t.review_workflow.some((function(t){return"4-1"==t.action}))?a("span",{staticClass:"gray ml10",staticStyle:{"font-size":"14px"}},[t._v("推送人："+t._s(t.review_workflow.find((function(t){return"4-1"==t.action})).executor)+" "+t._s(t.review_workflow.find((function(t){return"4-1"==t.action})).actionTime))]):t._e()],1):t._e(),t.care_plan.push&&!t.care_plan.confirm?a("div",{staticClass:"mt10"},[a("el-tag",{attrs:{type:"info"}},[t._v("用户未确认")])],1):t._e(),t.care_plan.push&&t.care_plan.confirm?a("div",{staticClass:"mt10"},[a("el-tag",{attrs:{type:"success",effect:"dark"}},[t._v("用户已确认")]),t.review_workflow&&t.review_workflow.some((function(t){return"4-2"==t.action}))?a("span",{staticClass:"gray ml10",staticStyle:{"font-size":"14px"}},[t._v("确认时间："+t._s(t.review_workflow.find((function(t){return"4-2"==t.action})).actionTime))]):t._e()],1):t._e()]:t._e()],2)],2),a("el-step",[a("p",{staticClass:"tt",attrs:{slot:"title"},slot:"title"},[t._v(" 退款情况 "),t.review_workflow&&t.review_workflow.some((function(t){return 5==t.action}))?a("span",[t._v(t._s(t.review_workflow.find((function(t){return 5==t.action})).actionTime)+" "+t._s(t.review_workflow.find((function(t){return 5==t.action})).executor))]):t._e()]),a("template",{slot:"description"},[a("el-radio-group",{attrs:{disabled:4!==t.finishStep},model:{value:t.care_plan.money_return,callback:function(e){t.$set(t.care_plan,"money_return",e)},expression:"care_plan.money_return"}},[a("el-radio",{attrs:{label:"1"}},[t._v("押金全额退还")]),a("el-radio",{attrs:{label:"2"}},[t._v("押金部分退还(结算租金)")]),a("el-radio",{attrs:{label:"3"}},[t._v("补差价购买设备")]),a("el-radio",{staticClass:"mt10",attrs:{label:"4"}},[t._v("押金不退还")])],1)],1)],2),a("el-step",[a("p",{staticClass:"tt",attrs:{slot:"title"},slot:"title"},[t._v(" 完成 "),t.review_workflow&&t.review_workflow.some((function(t){return 6==t.action}))?a("span",[t._v(t._s(t.review_workflow.find((function(t){return 6==t.action})).actionTime)+" "+t._s(t.review_workflow.find((function(t){return 6==t.action})).executor))]):t._e()])])]:[a("el-step",[a("p",{staticClass:"tt",attrs:{slot:"title"},slot:"title"},[t._v(" 与用户确认方式 "),t.review_workflow&&t.review_workflow.some((function(t){return 2==t.action}))?a("span",[t._v(t._s(t.review_workflow.find((function(t){return 2==t.action})).actionTime)+" "+t._s(t.review_workflow.find((function(t){return 2==t.action})).executor))]):t._e()]),a("template",{slot:"description"},[a("el-radio-group",{attrs:{disabled:1!==t.finishStep},model:{value:t.care_plan.confirm_letter,callback:function(e){t.$set(t.care_plan,"confirm_letter",e)},expression:"care_plan.confirm_letter"}},[a("el-radio",{attrs:{label:!0}},[t._v("确认函")]),a("el-radio",{attrs:{label:!1}},[t._v("无需确认")])],1),t.care_plan.confirm_letter?[t.care_plan.push?t._e():a("div",{staticClass:"mt10"},[a("el-button",{attrs:{loading:t.onPush,type:"primary",plain:"",disabled:!t.isFollow||t.finishStep<1||6===t.finishStep},on:{click:t.pushMessage}},[t._v("推送确认函")]),t.isFollow||1!==t.finishStep?t._e():a("span",{staticClass:"red ml10"},[t._v("未关注公众号")])],1),t.care_plan.push?a("div",{staticClass:"mt10"},[a("el-tag",{staticStyle:{width:"82px","text-align":"center"},attrs:{type:"success",effect:"dark"}},[t._v("已推送")]),t.review_workflow&&t.review_workflow.some((function(t){return"4-1"==t.action}))?a("span",{staticClass:"gray ml10",staticStyle:{"font-size":"14px"}},[t._v("推送人："+t._s(t.review_workflow.find((function(t){return"4-1"==t.action})).executor)+" "+t._s(t.review_workflow.find((function(t){return"4-1"==t.action})).actionTime))]):t._e()],1):t._e(),t.care_plan.push&&!t.care_plan.confirm?a("div",{staticClass:"mt10"},[a("el-tag",{attrs:{type:"info"}},[t._v("用户未确认")])],1):t._e(),t.care_plan.push&&t.care_plan.confirm?a("div",{staticClass:"mt10"},[a("el-tag",{attrs:{type:"success",effect:"dark"}},[t._v("用户已确认")]),t.review_workflow&&t.review_workflow.some((function(t){return"4-2"==t.action}))?a("span",{staticClass:"gray ml10",staticStyle:{"font-size":"14px"}},[t._v("确认时间："+t._s(t.review_workflow.find((function(t){return"4-2"==t.action})).actionTime))]):t._e()],1):t._e()]:t._e()],2)],2),a("el-step",[a("p",{staticClass:"tt",attrs:{slot:"title"},slot:"title"},[t._v(" 完成 "),t.review_workflow&&t.review_workflow.some((function(t){return 3==t.action}))?a("span",[t._v(t._s(t.review_workflow.find((function(t){return 3==t.action})).actionTime)+" "+t._s(t.review_workflow.find((function(t){return 3==t.action})).executor))]):t._e()])])]],2)],1),t.finishStep<6&&2!==t.care_plan.device_status||t.finishStep<3&&2===t.care_plan.device_status?a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogCourseVisible=!1}}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.nextStep}},[t._v(t._s(t.finishStep>=5&&2!==t.care_plan.device_status||t.finishStep>=2&&2===t.care_plan.device_status?"确定":"下一步"))])],1):t._e()]),a("el-dialog",{attrs:{width:"600px",visible:t.dialogNextVisible},on:{"update:visible":function(e){t.dialogNextVisible=e}}},[a("div",{attrs:{slot:"title"},slot:"title"},[t._v(" 启动下一个疗程 "),t.startNextStep<6&&!t.care_plan.start_next_time||t.dayjs()<t.dayjs(t.care_plan.start_next_time)?a("el-button",{staticClass:"ml10",attrs:{size:"mini",icon:"el-icon-refresh"},on:{click:t.getCarePlan}},[t._v("刷新")]):t._e()],1),a("div",[a("el-steps",{attrs:{direction:"vertical",active:t.startNextStep}},[a("el-step",[a("p",{staticClass:"tt",attrs:{slot:"title"},slot:"title"},[t._v(" 当前疗程是否达标 "),t.start_next_workflow&&t.start_next_workflow.some((function(t){return"1"==t.action}))?a("span",[t._v(t._s(t.start_next_workflow.find((function(t){return"1"==t.action})).actionTime)+" "+t._s(t.start_next_workflow.find((function(t){return"1"==t.action})).executor))]):t._e()]),a("template",{slot:"description"},[a("el-radio-group",{attrs:{disabled:!(!t.care_plan.start_next_time||t.dayjs()<t.dayjs(t.care_plan.start_next_time))},model:{value:t.care_plan.start_next_is_qualified,callback:function(e){t.$set(t.care_plan,"start_next_is_qualified",e)},expression:"care_plan.start_next_is_qualified"}},[a("el-radio",{attrs:{label:!0}},[t._v("已达标")]),a("el-radio",{attrs:{label:!1}},[t._v("未达标")])],1)],1)],2),a("el-step",[a("p",{staticClass:"tt",attrs:{slot:"title"},slot:"title"},[t._v(" 当前疗程设备情况 "),t.start_next_workflow&&t.start_next_workflow.some((function(t){return"2"==t.action}))?a("span",[t._v(t._s(t.start_next_workflow.find((function(t){return"2"==t.action})).actionTime)+" "+t._s(t.start_next_workflow.find((function(t){return"2"==t.action})).executor))]):t._e()]),a("template",{slot:"description"},[a("el-radio-group",{attrs:{disabled:1!==t.startNextStep},model:{value:t.care_plan.device_status,callback:function(e){t.$set(t.care_plan,"device_status",e)},expression:"care_plan.device_status"}},[a("el-radio",{attrs:{label:1}},[t._v("租赁的设备")]),a("el-radio",{attrs:{label:2}},[t._v("购买的设备")])],1)],1)],2),2!==t.care_plan.device_status?[a("el-step",[a("p",{staticClass:"tt",attrs:{slot:"title"},slot:"title"},[t._v(" 设备退还情况 "),t.start_next_workflow&&t.start_next_workflow.some((function(t){return"3"==t.action}))?a("span",[t._v(t._s(t.start_next_workflow.find((function(t){return"3"==t.action})).actionTime)+" "+t._s(t.start_next_workflow.find((function(t){return"3"==t.action})).executor))]):t._e()]),a("template",{slot:"description"},[a("el-radio-group",{attrs:{disabled:t.startNextStep<2||!(!t.care_plan.start_next_time||t.dayjs()<t.dayjs(t.care_plan.start_next_time))},model:{value:t.care_plan.start_next_device_return,callback:function(e){t.$set(t.care_plan,"start_next_device_return",e)},expression:"care_plan.start_next_device_return"}},[a("el-radio",{attrs:{label:!1}},[t._v("继续使用")]),a("el-radio",{attrs:{label:!0}},[t._v("有损退还更换")])],1),t.care_plan.start_next_device_return||""===t.care_plan.start_next_device_return?a("div",{staticClass:"flex js-b mt10 mb10"},[a("label",{staticStyle:{width:"100px","line-height":"32px","font-weight":"normal"}},[t._v("核算损坏金额：")]),a("el-input",{staticStyle:{width:"140px"},attrs:{suffix:"元",type:"text",disabled:t.startNextStep<2||!(!t.care_plan.start_next_time||t.dayjs()<t.dayjs(t.care_plan.start_next_time))},model:{value:t.care_plan.start_next_device_damage_fee,callback:function(e){t.$set(t.care_plan,"start_next_device_damage_fee",e)},expression:"care_plan.start_next_device_damage_fee"}},[t._t("default",[t._v("元")],{slot:"suffix"})],2)],1):t._e()],1)],2),a("el-step",[a("p",{staticClass:"tt",attrs:{slot:"title"},slot:"title"},[t._v(" 费用支付情况 "),t.start_next_workflow&&t.start_next_workflow.some((function(t){return"4"==t.action}))?a("span",[t._v(t._s(t.start_next_workflow.find((function(t){return"4"==t.action})).actionTime)+" "+t._s(t.start_next_workflow.find((function(t){return"4"==t.action})).executor))]):t._e()]),a("template",{slot:"description"},[t.care_plan.start_next_is_qualified?t._e():a("div",{staticClass:"flex js-b mt10"},[a("label",{staticStyle:{width:"80px","line-height":"32px","font-weight":"normal"}},[t._v("核算租金：")]),a("el-input",{staticStyle:{width:"140px"},attrs:{suffix:"元",type:"text",disabled:t.startNextStep<3||!(!t.care_plan.start_next_time||t.dayjs()<t.dayjs(t.care_plan.start_next_time))},model:{value:t.care_plan.start_next_fee,callback:function(e){t.$set(t.care_plan,"start_next_fee",e)},expression:"care_plan.start_next_fee"}},[t._t("default",[t._v("元")],{slot:"suffix"})],2)],1),a("div",{staticClass:"flex js-b"},[a("label",{staticStyle:{width:"110px","line-height":"32px","font-weight":"normal"}},[t._v("核算费用支付：")]),a("el-radio-group",{attrs:{disabled:t.startNextStep<3||!(!t.care_plan.start_next_time||t.dayjs()<t.dayjs(t.care_plan.start_next_time))},model:{value:t.care_plan.start_next_paid,callback:function(e){t.$set(t.care_plan,"start_next_paid",e)},expression:"care_plan.start_next_paid"}},[a("el-radio",{attrs:{label:!0}},[t._v("已完成支付")]),a("el-radio",{attrs:{label:!1}},[t._v("无需支付")])],1)],1)])],2),a("el-step",[a("p",{staticClass:"tt",attrs:{slot:"title"},slot:"title"},[t._v(" 启动下一疗程 "),t.start_next_workflow&&t.start_next_workflow.some((function(t){return"5"==t.action}))?a("span",[t._v(t._s(t.start_next_workflow.find((function(t){return"5"==t.action})).actionTime)+" "+t._s(t.start_next_workflow.find((function(t){return"5"==t.action})).executor))]):t._e()]),a("template",{slot:"description"},[a("div",{staticClass:"flex js-b mt10"},[a("label",{staticStyle:{width:"90px","line-height":"32px","font-weight":"normal"}},[t._v("启动时间：")]),a("el-date-picker",{attrs:{disabled:t.startNextStep<4||!(!t.care_plan.start_next_time||t.dayjs()<t.dayjs(t.care_plan.start_next_time)),type:"date","value-format":"yyyy-MM-dd 00:00:00",placeholder:"选择日期","picker-options":t.startNextTimeOptions},on:{change:function(e){t.care_plan.start_next_push=!1,t.care_plan.start_next_confirm=!1}},model:{value:t.care_plan.start_next_time,callback:function(e){t.$set(t.care_plan,"start_next_time",e)},expression:"care_plan.start_next_time"}})],1),a("el-radio-group",{attrs:{disabled:t.startNextStep<4||!(!t.care_plan.start_next_time||t.dayjs()<t.dayjs(t.care_plan.start_next_time))},model:{value:t.care_plan.start_next_device_status,callback:function(e){t.$set(t.care_plan,"start_next_device_status",e)},expression:"care_plan.start_next_device_status"}},[a("el-radio",{attrs:{label:1}},[t._v("租赁设备")]),a("el-radio",{attrs:{label:2}},[t._v("购买设备")])],1),t.care_plan.start_next_time&&(!t.care_plan.start_next_push||t.care_plan.start_next_device_status!==t.start_next_device_status)&&t.dayjs()<t.dayjs(t.care_plan.start_next_time)?a("div",{staticClass:"mt10"},[a("el-button",{attrs:{loading:t.onPush,type:t.isFollow?"primary":"info",plain:"",disabled:!t.isFollow||t.startNextStep<4},on:{click:t.nextPushMessage}},[t._v(t._s(2!==t.care_plan.start_next_device_status?"推送知情同意书":"推送启动确认函"))]),t.isFollow||4!==t.startNextStep?t._e():a("span",{staticClass:"red ml10"},[t._v("未关注公众号")])],1):t._e(),t.care_plan.start_next_device_status===t.start_next_device_status?[t.care_plan.start_next_push?a("div",{staticClass:"mt10"},[a("el-tag",{staticStyle:{width:"82px","text-align":"center"},attrs:{type:"success",effect:"dark"}},[t._v("已推送")]),t.start_next_workflow&&t.start_next_workflow.some((function(t){return"4-1"==t.action}))?a("span",{staticClass:"gray ml10",staticStyle:{"font-size":"14px"}},[t._v("推送人："+t._s(t.start_next_workflow.find((function(t){return"4-1"==t.action})).executor)+" "+t._s(t.start_next_workflow.find((function(t){return"4-1"==t.action})).actionTime))]):t._e()],1):t._e(),t.care_plan.start_next_push&&!t.care_plan.start_next_confirm?a("div",{staticClass:"mt10"},[a("el-tag",{attrs:{type:"info"}},[t._v("用户未确认")])],1):t._e(),t.care_plan.start_next_push&&t.care_plan.start_next_confirm?a("div",{staticClass:"mt10"},[a("el-tag",{attrs:{type:"success",effect:"dark"}},[t._v("用户已确认")]),t.start_next_workflow&&t.start_next_workflow.some((function(t){return"4-2"==t.action}))?a("span",{staticClass:"gray ml10",staticStyle:{"font-size":"14px"}},[t._v("确认时间："+t._s(t.start_next_workflow.find((function(t){return"4-2"==t.action})).actionTime))]):t._e(),a("a",{staticClass:"blue ml10",on:{click:function(e){return t.showNextContract(t.care_plan.start_next_device_status)}}},[t._v("查看详情")])],1):t._e()]:t._e()],2)],2),a("el-step",[a("p",{staticClass:"tt",attrs:{slot:"title"},slot:"title"},[t._v(" 完成 "),t.start_next_workflow&&t.start_next_workflow.some((function(t){return"6"==t.action}))?a("span",[t._v(t._s(t.start_next_workflow.find((function(t){return"6"==t.action})).actionTime)+" "+t._s(t.start_next_workflow.find((function(t){return"6"==t.action})).executor))]):t._e()])])]:[a("el-step",[a("p",{staticClass:"tt",attrs:{slot:"title"},slot:"title"},[t._v(" 启动下一疗程 "),t.start_next_workflow&&t.start_next_workflow.some((function(t){return"3"==t.action}))?a("span",[t._v(t._s(t.start_next_workflow.find((function(t){return"3"==t.action})).actionTime)+" "+t._s(t.start_next_workflow.find((function(t){return"3"==t.action})).executor))]):t._e()]),a("template",{slot:"description"},[a("div",{staticClass:"flex js-b mt10"},[a("label",{staticStyle:{width:"90px","line-height":"32px","font-weight":"normal"}},[t._v("启动时间：")]),a("el-date-picker",{attrs:{disabled:t.startNextStep<2||!(!t.care_plan.start_next_time||t.dayjs()<t.dayjs(t.care_plan.start_next_time)),type:"date","value-format":"yyyy-MM-dd 00:00:00",placeholder:"选择日期","picker-options":t.startNextTimeOptions},on:{change:function(e){t.care_plan.start_next_push=!1,t.care_plan.start_next_confirm=!1}},model:{value:t.care_plan.start_next_time,callback:function(e){t.$set(t.care_plan,"start_next_time",e)},expression:"care_plan.start_next_time"}})],1),a("el-radio-group",{attrs:{disabled:t.startNextStep<2||!(!t.care_plan.start_next_time||t.dayjs()<t.dayjs(t.care_plan.start_next_time))},model:{value:t.care_plan.start_next_device_status,callback:function(e){t.$set(t.care_plan,"start_next_device_status",e)},expression:"care_plan.start_next_device_status"}},[a("el-radio",{attrs:{label:1}},[t._v("租赁设备")]),a("el-radio",{attrs:{label:2}},[t._v("购买设备")])],1),t.care_plan.start_next_time&&(!t.care_plan.start_next_push||t.care_plan.start_next_device_status!==t.start_next_device_status)&&t.dayjs()<t.dayjs(t.care_plan.start_next_time)?a("div",{staticClass:"mt10"},[a("el-button",{attrs:{loading:t.onPush,type:"primary",plain:"",disabled:!t.isFollow||t.startNextStep<2},on:{click:t.nextPushMessage}},[t._v(t._s(2!==t.care_plan.start_next_device_status?"推送知情同意书":"推送启动确认函"))]),t.isFollow||2!==t.startNextStep?t._e():a("span",{staticClass:"red ml10"},[t._v("未关注公众号")])],1):t._e(),t.care_plan.start_next_device_status===t.start_next_device_status?[t.care_plan.start_next_push?a("div",{staticClass:"mt10"},[a("el-tag",{staticStyle:{width:"82px","text-align":"center"},attrs:{type:"success",effect:"dark"}},[t._v("已推送")]),t.start_next_workflow&&t.start_next_workflow.some((function(t){return"4-1"==t.action}))?a("span",{staticClass:"gray ml10",staticStyle:{"font-size":"14px"}},[t._v("推送人："+t._s(t.start_next_workflow.find((function(t){return"4-1"==t.action})).executor)+" "+t._s(t.start_next_workflow.find((function(t){return"4-1"==t.action})).actionTime))]):t._e()],1):t._e(),t.care_plan.start_next_push&&!t.care_plan.start_next_confirm?a("div",{staticClass:"mt10"},[a("el-tag",{attrs:{type:"info"}},[t._v("用户未确认")])],1):t._e(),t.care_plan.start_next_push&&t.care_plan.start_next_confirm?a("div",{staticClass:"mt10"},[a("el-tag",{attrs:{type:"success",effect:"dark"}},[t._v("用户已确认")]),t.start_next_workflow&&t.start_next_workflow.some((function(t){return"4-2"==t.action}))?a("span",{staticClass:"gray ml10",staticStyle:{"font-size":"14px"}},[t._v("确认时间："+t._s(t.start_next_workflow.find((function(t){return"4-2"==t.action})).actionTime))]):t._e(),a("a",{staticClass:"blue ml10",on:{click:function(e){return t.showNextContract(t.care_plan.start_next_device_status)}}},[t._v("查看详情")])],1):t._e()]:t._e()],2)],2),a("el-step",[a("p",{staticClass:"tt",attrs:{slot:"title"},slot:"title"},[t._v(" 完成 "),t.start_next_workflow&&t.start_next_workflow.some((function(t){return"4"==t.action}))?a("span",[t._v(t._s(t.start_next_workflow.find((function(t){return"4"==t.action})).actionTime)+" "+t._s(t.start_next_workflow.find((function(t){return"4"==t.action})).executor))]):t._e()])])]],2)],1),t.care_plan.start_next_time&&t.dayjs()<t.dayjs(t.care_plan.start_next_time)||t.startNextStep<6&&2!==t.care_plan.device_status||t.startNextStep<4&&2===t.care_plan.device_status?a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogNextVisible=!1}}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.nextPlanStep}},[t._v(t._s(t.startNextStep>=5&&2!==t.care_plan.device_status||t.startNextStep>=3&&2===t.care_plan.device_status?"确定":"下一步"))])],1):t._e()]),a("careplan-contract",{ref:"careplanContract"})],1)},s=[],n=(a("4de4"),a("d81d"),a("13d5"),a("fb6a"),a("a434"),a("ade3")),i=a("5530"),l=(a("96cf"),a("1da1")),_=a("5a0c"),c=a.n(_),o=a("d772"),p=a.n(o),u=a("74fe");c.a.extend(p.a);var d={components:{CareplanContract:u["a"]},data:function(){var t=this;return{planId:"",patientId:"",record:{},care_plan_list:[],care_plan:{},tableData:[],carePlanNumber:"",viewIndex:2,isFollow:"",finishStep:0,finishCourse:!1,deviceRadio:"",finishRemark:"",refund:"",return_money:"",page:1,size:10,total:0,isNextChecked:!1,dialogCourseVisible:!1,dialogNextVisible:!1,nextBtnVisible:!1,startDate:"",remark:"",dayjs:c.a,review_workflow:[],start_next_workflow:[],startNextStep:0,start_next_device_status:"",onPush:!1,startNextTimeOptions:{disabledDate:function(e){return t.finishStep<=3&&c()(t.care_plan.actual_end_time)>c()()?e.getTime()<new Date(t.care_plan.actual_end_time).getTime():e.getTime()<(new Date).getTime()}},goods_state:["在库","已租赁","已销售","退货入库"]}},created:function(){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.planId=t.$route.query.id,t.patientId=t.$route.query.patient_id,t.isFollow="false"!=t.$route.query.isFollow&&t.$route.query.isFollow,t.viewIndex=1==t.$route.query.viewIndex?2:t.$route.query.viewIndex,e.next=6,t.getPatientmgmt();case 6:case"end":return e.stop()}}),e)})))()},methods:{getPatientmgmt:function(t){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function a(){var r,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,e.$api.patientmgmt.getPatientmgmt(e.patientId);case 2:r=a.sent,s=r.data,0==s.errcode&&(console.log(s.data.record),e.record=s.data.record,e.care_plan_list=s.data.record.care_plan_list.reverse(),e.care_plan_list.map((function(t,a){c()(t.start_time)>c()()&&e.care_plan_list.slice(a,1)})),e.care_plan=e.care_plan_list.filter((function(t){return t.current_plan})),t?e.planId=t:(e.care_plan=e.care_plan[0],1===e.care_plan_list.length&&(e.care_plan=e.care_plan_list[0]),e.carePlanNumber=e.care_plan.number,e.planId=e.care_plan.plan_id),e.getCarePlan());case 5:case"end":return a.stop()}}),a)})))()},getCarePlan:function(){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function e(){var a,r,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$api.patientmgmt.getCarePlan(t.planId);case 2:a=e.sent,r=a.data,0==r.errcode&&(s=r.data.record,t.care_plan=Object(i["a"])(Object(i["a"])({},t.care_plan),s),t.care_plan.device_status=parseInt(t.care_plan.device_status),t.care_plan.start_next_device_status=parseInt(t.care_plan.start_next_device_status||1),t.start_next_device_status=t.care_plan.start_next_device_status,t.dataRender(),t.finishStep=s.apply_close_step||0,t.review_workflow=JSON.parse(s.review_workflow),t.startNextStep=s.start_next_step||0,t.start_next_workflow=s.start_next_workflow&&JSON.parse(s.start_next_workflow),t.review_workflow=t.review_workflow&&t.arrayUnique2(t.review_workflow,"action"),t.start_next_workflow=t.start_next_workflow&&t.arrayUnique2(t.start_next_workflow,"action"),t.start_next_workflow&&c()(s.start_next_time)<c()("2022-4-24")&&(t.start_next_workflow.unshift(t.start_next_workflow[0]),t.startNextStep=6,t.care_plan.start_next_device_status=1),t.finishStep>0&&(t.finishCourse=!0),t.care_plan.start_next_flag?t.nextBtnVisible=!1:t.nextBtnVisible=!0);case 5:case"end":return e.stop()}}),e)})))()},dataRender:function(){var t=this.care_plan.actual_end_time||this.care_plan.end_time;this.care_plan.start_time?c()()>c()(t)?Math.ceil(c.a.duration(c()(t).diff(c()(this.care_plan.start_time))).as("day"))<89?this.care_plan.days=Math.ceil(c.a.duration(c()(t).diff(c()(this.care_plan.start_time))).as("day"))>0?Math.ceil(c.a.duration(c()(t).diff(c()(this.care_plan.start_time))).as("day")):0:this.care_plan.days=90:this.care_plan.days=Math.ceil(c.a.duration(c()().diff(c()(this.care_plan.start_time))).as("day"))>0?Math.ceil(c.a.duration(c()().diff(c()(this.care_plan.start_time))).as("day")):0:this.care_plan.days=0,console.log(this.care_plan.start_time);var e=document.getElementsByClassName("el-progress__text");null==this.care_plan.pef_qualified_rate?e[0].textContent="--":e[0].textContent=this.care_plan.pef_qualified_rate+"%",null==this.care_plan.drug_qualified_rate?e[1].textContent="--":e[1].textContent=this.care_plan.drug_qualified_rate+"%",null==this.care_plan.followup_qualified_rate?e[2].textContent="--":e[2].textContent=this.care_plan.followup_qualified_rate+"%",this.care_plan.diary_list&&this.care_plan.diary_list.map((function(t){t.remain_days=parseInt(c.a.duration(c()().diff(c()(t.date))).as("day")),t.remain_days<4?t.has_expire=!1:t.has_expire=!0})),this.care_plan.task_list&&this.care_plan.task_list.map((function(t){t.remain_days=parseInt(c.a.duration(c()().diff(c()(t.sent_time))).as("day")),t.remain_days<8?t.has_expire=!1:t.has_expire=!0})),2==this.viewIndex&&(this.tableData=this.care_plan.diary_list),3==this.viewIndex&&(this.tableData=this.care_plan.task_list)},makeupMessage:function(t,e){var a=this;return Object(l["a"])(regeneratorRuntime.mark((function r(){var s,n,i;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return 1===e&&(s=t.diary_id),2===e&&(s=t.task_id),r.next=4,a.$api.patientmgmt.makeupMessage({record_id:s,type:e});case 4:n=r.sent,i=n.data,0==i.errcode&&(a.$message({message:"提醒成功",type:"success"}),t.qy_user_sent=!0);case 7:case"end":return r.stop()}}),r)})))()},endCarePlan:function(){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function e(){var a,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$api.patientmgmt.endCarePlan({apply_close_step:t.finishStep,device_return:t.care_plan.device_return,device_status:t.care_plan.device_status,money_return:t.care_plan.money_return,plan_id:t.planId,remark:t.care_plan.remark,return_money:t.care_plan.return_money,confirm_money:t.care_plan.confirm_money,push:t.care_plan.push,confirm_letter:t.care_plan.confirm_letter});case 2:a=e.sent,r=a.data,0==r.errcode&&t.getCarePlan();case 5:case"end":return e.stop()}}),e)})))()},pushMessage:function(){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function e(){var a,r,s,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=1===t.care_plan.device_status?3:2,t.onPush=!0,e.next=4,t.$api.patientmgmt.pushMessage((a={patient_id:t.patientId,apply_close_step:r,child_close_step:"4-1",device_return:t.care_plan.device_return,money_return:t.care_plan.money_return,device_status:t.care_plan.device_status,plan_id:t.planId,push:!0,remark:t.care_plan.remark,return_money:t.care_plan.return_money,confirm_money:t.care_plan.confirm_money},Object(n["a"])(a,"push",t.care_plan.push),Object(n["a"])(a,"confirm_letter",t.care_plan.confirm_letter),a));case 4:s=e.sent,i=s.data,t.onPush=!1,0==i.errcode&&(t.$message({message:"推送成功",type:"success"}),t.care_plan.push=!0,t.getCarePlan()),"未关注公众号"==i.errmsg&&t.$message({message:"未关注公众号",type:"error"});case 9:case"end":return e.stop()}}),e)})))()},startNext:function(){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function e(){var a,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$api.patientmgmt.startNext({patient_id:t.patientId,plan_id:t.planId,start_next_step:t.startNextStep,start_next_device_damage_fee:t.care_plan.start_next_device_damage_fee,start_next_device_return:t.care_plan.start_next_device_return,device_status:t.care_plan.device_status,start_next_device_status:t.care_plan.start_next_device_status,start_next_fee:t.care_plan.start_next_fee,start_next_flag:t.care_plan.start_next_flag||!1,start_next_is_qualified:t.care_plan.start_next_is_qualified,start_next_paid:t.care_plan.start_next_paid,start_next_remark:t.care_plan.start_next_remark,start_next_time:t.care_plan.start_next_time,start_next_confirm:t.care_plan.start_next_confirm,start_next_push:t.care_plan.start_next_push});case 2:a=e.sent,r=a.data,0==r.errcode?t.getCarePlan():t.$message({message:"系统错误",type:"error"});case 5:case"end":return e.stop()}}),e)})))()},nextPushMessage:function(){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function e(){var a,r,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.care_plan.start_next_time){e.next=3;break}return t.$message({message:"未选择启动下一疗程的启动时间",type:"error"}),e.abrupt("return");case 3:return t.onPush=!0,a=1===t.care_plan.device_status?4:2,e.next=7,t.$api.patientmgmt.nextPushMessage({patient_id:t.patientId,plan_id:t.planId,start_next_step:a,start_next_child_step:"4-1",start_next_device_damage_fee:t.care_plan.start_next_device_damage_fee,start_next_device_return:t.care_plan.start_next_device_return,device_status:t.care_plan.device_status,start_next_device_status:t.care_plan.start_next_device_status,start_next_fee:t.care_plan.start_next_fee,start_next_flag:t.care_plan.start_next_flag||!1,start_next_is_qualified:t.care_plan.start_next_is_qualified,start_next_paid:t.care_plan.start_next_paid,start_next_remark:t.care_plan.start_next_remark,start_next_time:t.care_plan.start_next_time,start_next_confirm:t.care_plan.start_next_confirm,start_next_push:!0});case 7:r=e.sent,s=r.data,t.onPush=!1,0==s.errcode&&(t.$message({message:"推送成功",type:"success"}),t.getCarePlan(),t.care_plan.start_next_push=!0),"未关注公众号"==s.errmsg&&t.$message({message:"未关注公众号",type:"error"});case 12:case"end":return e.stop()}}),e)})))()},remind:function(t,e){this.makeupMessage(t,e)},nextStep:function(){2===this.care_plan.status||this.finishCourse?this.care_plan.device_status?1===this.care_plan.device_status&&this.finishStep>=1&&!this.care_plan.device_return?this.$message({message:"未选择设备退还情况 ",type:"error"}):1===this.care_plan.device_status&&this.finishStep>=2&&!this.care_plan.return_money?this.$message({message:"未填写核算金额",type:"error"}):1===this.care_plan.device_status&&this.finishStep>=3&&!this.care_plan.confirm_money?this.$message({message:"未填写确认金额",type:"error"}):(this.finishStep>=3||1==this.finishStep&&2===this.care_plan.device_status)&&"undefined"===typeof this.care_plan.confirm_letter?this.$message({message:"未选择确认方式",type:"error"}):(this.finishStep>=3||1==this.finishStep&&2===this.care_plan.device_status)&&this.care_plan.confirm_letter&&!this.care_plan.push?this.$message({message:"未推送确认函",type:"error"}):(this.finishStep>=3||1==this.finishStep&&2===this.care_plan.device_status)&&this.care_plan.confirm_letter&&!this.care_plan.confirm?this.$message({message:"用户未确认",type:"error"}):1===this.care_plan.device_status&&this.finishStep>=4&&!this.care_plan.money_return?this.$message({message:"未选择退款情况 ",type:"error"}):(this.finishStep++,console.log(this.care_plan.confirm_letter),this.endCarePlan(),(6===this.finishStep||3===this.finishStep&&2===this.care_plan.device_status)&&(this.dialogCourseVisible=!1,this.$message({message:"操作完成 ",type:"success"}),this.getPatientmgmt(this.planId))):this.$message({message:"未选择当前疗程设备情况",type:"error"}):this.$message({message:"未勾选确认提前结束疗程 ",type:"error"})},nextPlanStep:function(){console.log(this.startNextStep),""!==this.care_plan.start_next_is_qualified&&null!==this.care_plan.start_next_is_qualified?(console.log(this.care_plan.device_status),this.startNextStep>=1&&!this.care_plan.device_status?this.$message({message:"未选择当前疗程设备情况",type:"error"}):2!==this.care_plan.device_status&&this.startNextStep>=2&&(""===this.care_plan.start_next_device_return||null===this.care_plan.start_next_device_return)?this.$message({message:"未选择设备是否退还",type:"error"}):2!==this.care_plan.device_status&&this.startNextStep>=2&&this.care_plan.start_next_device_return&&!this.care_plan.start_next_device_damage_fee?this.$message({message:"未填写核算损坏金额",type:"error"}):2!==this.care_plan.device_status&&this.startNextStep>=3&&!this.care_plan.start_next_is_qualified&&!this.care_plan.start_next_fee?this.$message({message:"未填写核算租金 ",type:"error"}):2!==this.care_plan.device_status&&this.startNextStep>=3&&(""===this.care_plan.start_next_paid||null===this.care_plan.start_next_paid)?this.$message({message:"未选择核算费用支付情况 ",type:"error"}):!(this.startNextStep>=4&&2!==this.care_plan.device_status||this.startNextStep>=2&&2===this.care_plan.device_status)||this.care_plan.start_next_time?!(this.startNextStep>=4&&2!==this.care_plan.device_status||this.startNextStep>=2&&2===this.care_plan.device_status)||this.care_plan.start_next_push?!(this.startNextStep>=4&&2!==this.care_plan.device_status||this.startNextStep>=2&&2===this.care_plan.device_status)||this.care_plan.start_next_confirm?(this.startNextStep<6?this.startNextStep++:this.startNextStep=6,(6===this.startNextStep||4===this.startNextStep&&2===this.care_plan.device_status)&&(this.care_plan.start_next_flag=!0),this.startNext(),(6===this.startNextStep||4===this.startNextStep&&2===this.care_plan.device_status)&&(this.dialogNextVisible=!1,this.$message({message:"操作完成 ",type:"success"}),this.getPatientmgmt(this.planId))):this.$message({message:"用户未确认",type:"error"}):this.$message({message:"未推送知情同意书",type:"error"}):this.$message({message:"未选择启动下一疗程的启动时间",type:"error"})):this.$message({message:"未选择当前疗程是否达标 ",type:"error"})},changeMoneyReturn:function(){2==this.record.money_return&&(this.record.return_money=0)},handleSizeChange:function(t){this.size=t},handleCurrentChange:function(t){this.page=t},changeCarePlan:function(){var t=this;this.care_plan=this.care_plan_list.filter((function(e){return e.number===t.carePlanNumber}))[0],this.planId=this.care_plan.plan_id,this.getCarePlan()},changeViewIndex:function(){console.log(this.viewIndex),2==this.viewIndex?this.tableData=this.care_plan.diary_list:this.tableData=this.care_plan.task_list},arrayUnique2:function(t,e){var a={};return t.reduce((function(t,r,s){return a[r[e]]?t.splice(a[r[e]]["index"],1,r):(a[r[e]]={index:s},t.push(r)),t}),[])},showContract:function(t){this.$refs.careplanContract.dialogVisible=!0,this.$refs.careplanContract.getQueryCurrent(this.planId,t)},showNextContract:function(t){this.$refs.careplanContract.dialogVisible=!0,this.$refs.careplanContract.getQueryNext(this.planId,t)}}},f=d,m=(a("bf85"),a("99d9"),a("b753"),a("2877")),x=Object(m["a"])(f,r,s,!1,null,"5f366d4f",null);e["default"]=x.exports},"99d9":function(t,e,a){"use strict";var r=a("ded9"),s=a.n(r);s.a},b753:function(t,e,a){"use strict";var r=a("1266"),s=a.n(r);s.a},bf85:function(t,e,a){"use strict";var r=a("12cb"),s=a.n(r);s.a},ded9:function(t,e,a){}}]);